---
title: "Pyscript Next Release"
date: 2023-08-30T11:30:42-05:00
draft: true
tags:
- pyscript
- python
- pyscript-next
description: "Description Here"
---
<p class="post-p">Today marks the release of <span class="font-bold">PyScript Next</span>, a ground-up total-rewrite of PyScript that adds a wide swath of new functionality, smaller file sizes, faster loading, and so much more. This post (and really, this release) is a doozy, so get your brains in gear.</p>
<p class="post-p">Right off the bat, it's worth highlighting that this is a <span class="italic font-bold">fully breaking release</span>. While a lot of the features and concepts remain the same as in 'PyScript Classic' (our internal shorthand for all releases from Alpha/2022.05.1 through 2023.05.1), many features have been changed, tweaked, and added, there are also features that have either been removed from scope or have been temporarily removed as lower-priority in the name of getting this release out. As such, any articles and tutorials about PyScript prior to today should be taken as <span class="italic">potentially</span> deprecated.</p>
<p class="post-p">That said, much of the underpinnings of PyScript are still the same. It's still built on top of the <a href="https://pyodide.org">Pyodide Runtime</a>, it still allows users to run Python code directly in the browser using the CPython interpreter compiled to WASM etc. What's changed is how PyScript delivers that experience, in a way that's faster, lighter, and more web friendly.</p>
<p class="post-p">As this is a different kind of release from any of the previous ones, this Release Post also looks quite different. Rather than meticulously cateloging and demoing every single change and new feature, this post will:
    <ul class="post-ul">
        <li>Explore the major new features and attributes</li>
        <li>Expand on the performance and size differences</li>
        <li>Touch a little on the new structural differences and what PyScript Next is built on top of</li>
        <li>Highlight what's been left out of this release, that will (or won't) come back in future releases</li>
    </ul>
</p>
<p class="post-p">In the coming days and weeks, we'll take a closer look at PyScript Next's new features - in the meantime, here's the roaring headlines:</p>

<h2 class="post-h2">Running Code with PyScript</h2>
<p class="post-p">Just like in PyScript Classic, you can use PyScript on your page by adding a <code>&lt;script&gt;</code> tag that points to a specific url. Instead of using a custom address at <code class="code">pyscript.net></code>, PyScript now makes use of existing web architectures and CDNs. Either of the following will work, or other CDNs that mirror NPM like <code class="code">jsdelivr</code> etc. Trickly, some of these CDN's do <a href="https://github.com/pyscript/pyscript/issues/1688">some magic to try to help</a> which currently breaks some of PyScript's distribution - we recommend <code class="code">unpkg</code> as it seems to do the least modification of the file structure:</p>
{{< highlight "html" >}}
<!-- Latest Version -->
<script type="module" src="https://cdn.jsdelivr.net/npm/@pyscript/core"></script>

<!-- Specific Version -->
<script type="module" src="https://unpkg.com/@pyscript/core@0.2.1"></script>
{{< /highlight >}}
<p class="post-p">Note that the Pyodide runtime is not bootstrapped until the first <code>&lt;py-script&gt;</code> or <code>&lt;script type="py"&gt;</code> tag is encountered on the page. That is, if you're injecting PyScript tags dynamically, the Pyodide bootstrap process only happens when the first tag appears on the page.</p>

<h2 class="post-h2">Script Tags and Attributes</h2>
<h3 class="post-h3">Script Tags</h3>
<p class="post-p">To run Python code in the browser, wrap it in a <code>&lt;py-script&gt;</code> or <code>&lt;script type="py"&gt;</code> tag:</p>
{{< highlight "html" >}}
<py-script>
    print("Hello, world!")
</py-script>
{{< /highlight >}}
<br>
{{< highlight "html" >}}
<script type="py">
    for i in range(5):
        print(i)
</script>
{{< /highlight >}}

<p class="post-p">This will execute code in the browser with no backend using the <a href="https://pyodide.org/en/stable/">Pyodide</a> runtime. The two types of tags (<code>&lt;script type="py"&gt;</code> and <code>&lt;py-script&gt;</code> are equivalent from PyScript's point of view, and I will use <code>&lt;script type="py"&gt;</code> for the rest of this post. The <code class="code">script</code> tag has the advantage of not pre-parsing its context as text prior to being interpreted as code, which can cause parsing errors for code that looks like HTML tags inside a <code class="code">py-script</code> tag.</p>

<h3 class="post-h3">Tag Attributes</h3>
<h4 class="font-mono text-green-800 post-h4">src</h4>
<p class="post-p">The <code>src</code> attribute is a URL pointing to an external Python file to be used as the source code to execute. If included, any source written inside the actual <code>&lt;py-script&gt;</code> or <code>&lt;script type="py"&gt;</code> tag is ignored.</p>
{{< highlight "python3" >}}
# /some/url/my_module.py

print("Hello, world!")
{{< /highlight >}}
<br>
{{< highlight "html" >}}
<!-- index.html -->
<script type="py" src="/some/url/my_module.py"></script>
{{< /highlight >}}

<h4 class="font-mono text-green-800 post-h4">config</h4>
<p class="post-p">The <code>config</code> attribute defines the <span class="italic">configuration</span> to be used with a particular script tag. This can either be a URL (relative or fully qualified), or a string of JSON specifying the configuration directly. The options available to specify in a configuration are:</p>
XXXXXXXXXXXXXXXX

<h4 class="font-mono text-green-800 post-h4">env</h4>
<p class="post-p">The <code>env</code> attribute is a string which names a specific instance of the Pyodide interpreter to use to execute the specified code. Each Pyodide interpreter contains its own copy of the CPython runtime, its own filesystem, packages, etc. This provides full isolation between multiple blocks of code if they use separate <span class="italic">environments</span>, at the cost of additional memory usage. Each time a new script tag is encountered with a new or previously-unseen value for <code>env</code>, a new Pyodide interpreter is initialized to run that code. </p>
XXXXXXX Env Example

<h4 class="font-mono text-green-800 post-h4">async</h4>
<p class="post-p">Adding the <code>async</code> tag will run the Python code with <a href="/post/pyscript-asyncio#implicitasync">top level await</a> enabled. This allows users to use the <a href="https://docs.python.org/3/reference/compound_stmts.html#coroutines"><code>await</code>, <code>async for</code>, and <code>async with</code></a> statements at the top level of a module (i.e. not inside a coroutine/<code>async def</code> block). This allows users to, in essence, write coroutines which are automatically scheduled into an event loopw without using <code>asyncio.ensure_future</code> or similar.</p>

{{< highlight "html" >}}
<script type="py" async>
{{< /highlight >}}
{{< highlight "python3" >}}
    import asyncio
    
    print("Hello")
    await asyncio.sleep(1) # Normally top-level 'await' is forbidden, but allowed with 'async' tag attribute
    print("world")
{{< /highlight >}}
{{< highlight "html" >}}
</script>
{{< /highlight >}}

<h4 class="font-mono text-green-800 post-h4">worker</h4>
<p class="post-p">Adding the <code>worker</code> attribute to a script tag causes the Python code to be executed in a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">JS Web Worker</a>. The code can either be included in-line, or in an external file specified by the <code class="code">src</code> attribute. Note that each tag with the <code class="code">work</code> attribute runs in its own isolated worker thread - in the example below, the second <code class="code">worker</code> tag does not have access to the <code class="code">x</code> variable defined in the first tag, as they are running in separate interpreters/threads.</p>
<p class="post-p">Code running in a worker also accepts the <code>async</code> and <code>config</code> attributes, but XXXXX not an ENV?</p>

{{< highlight "html" "linenostart=1" >}}
<script type="py">
{{< /highlight >}}
{{< highlight "python3" "linenostart=2">}}
    from pyscript import display
    display(f"hello, world! {1+2=}")
{{< /highlight >}}
{{< highlight "html" "linenostart=4">}}
</script>
<script type="py" worker>
{{< /highlight >}}
{{< highlight "python3" "linenostart=6">}}
    from pyscript import display
    display("first worker")
    x = 1
    display(f"{x=}")
{{< /highlight >}}
{{< highlight "html" "linenostart=10">}}
</script>
<script type="py" worker>
{{< /highlight >}}
{{< highlight "python3" "linenostart=12">}}
    from pyscript import display
    display("second worker")
    display(f"{x=}") # Error
{{< /highlight >}}
{{< highlight "html" "linenostart=15">}}
</script>
{{< /highlight >}}

<p class="post-p">The use of worker threads via <a href="https://github.com/pyscript/polyscript/tree/main/docs#xworker">PolyScript's XWorker Utility</a> is an advanced but hugely powerful topic that deserves its own post. For the curious, see the <a href="https://github.com/pyscript/polyscript/tree/main/docs#xworker">PolyScript Documentation</a> as a place to get started.</p>

<h4 class="font-mono text-green-800 post-h4">target</h4>
<p class="post-p">Specifies the ID of an element in the DOM that calls to <code>display()</code> in this script tag should write their values to.</p>
XXXXXX Target Example

<h4 class="font-mono text-green-800 post-h4">version</h4>
<p class="post-p"></p>
XXXXXX Target Example


<style>
    code:not(.nocode):not(.language-python):not(.language-python3):not(.language-html):not(.language-js){
        --tw-text-opacity: 1;
        color: rgba(5, 120, 85, var(--tw-text-opacity));
    }
    .py-terminal{
        font-family: 'Courier New', Courier, monospace;
        min-height: 4em;
        background-color: black;
        color: white;
    }
    .invisible{
        visibility: hidden;
    }
    .control-button{
        padding: 0.5rem; 
        background-color: #E5E7EB; 
        border-radius: 0.375rem; 
        border-width: 2px; 
        border-color: #D1D5DB; 
    }
    .post-h2{
        border-bottom-width: 2px; 
        border-color: #F9FAFB; 
        border-style: solid;
    }
</style>