<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>7GUIs Pyscript - Explanations and Details</title>
	<meta name="description" content="Electronics, Making, Software Development, and Amateur Radio from a Midwest Nerd">
	
	
	
	
	<link rel ="stylesheet" type="text/css" href="../../css/style.css">
	
	<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jeff.glass/post/7-guis-pyscript/circles-feature.PNG"/>
<meta name="twitter:title" content="7GUIs Pyscript - Explanations and Details"/>
<meta name="twitter:description" content="Let&#39;s build &#39;The 7 GUIs&#39; with Python in the Browser using PyScript"/>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/css/lightbox.min.css" />	
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />

	
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BZTF8S6M1E"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BZTF8S6M1E', { 'anonymize_ip': false });
}
</script>


	<link rel="icon" href="../../favicon.ico?v=2"> 
	
</head>
<body>
	
	<main>
		<header>

<div class="fixed z-20 flex flex-row items-end w-full p-2 bg-green-800 t-0">
    
    <div class="flex-none hidden lg:flex">
        <div class="flex-none px-2">
            <span class="px-4 text-3xl font-bold text-green-200 transition duration-500 transform hover:text-green-50">
                <a href='../../' class= "no-style-link">Jeff Glass</a>
            </span>
        </div>
        <div class="flex-none menu-item-green ">
            <a href="../../#Introduction" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Home
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../project" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Projects
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../post" class="z-30 clickable-link-box no-style-link"><span></span></a> Blog  
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../oneoff" class="z-30 clickable-link-box no-style-link"><span></span></a>
            One-Offs
        </div>
    </div>
    
    <div class="flex justify-start flex-1 w-auto lg:hidden align-left large-menu">
        <div class="flex-none menu-item-green mobile-menu-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </div>
        <div class="flex-none">
            <span class="px-4 text-3xl font-bold text-green-200 transition duration-500 transform hover:text-green-50">
                <a href='../../' class= "no-style-link">Jeff Glass</a>
            </span>
        </div>
    </div>
    
    
    <div class="hidden text-green-200 transition mobile-menu">
            <div class="w-auto m-auto"><a href="../../"         class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Home</a></div>
            <div class="w-auto m-auto"><a href="../../project"  class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Projects</a></div>
            <div class="w-auto m-auto"><a href="../../post"     class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Blog</a></div>
            <div class="w-auto m-auto"><a href="../../oneoff"   class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">One-Offs</a></div>
    </div>
    
    <div class="justify-end flex-1 hidden w-auto h-auto align-top md:flex social-buttons">
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.youtube.com/channel/UCjgmTMVx2B5_DOB3bCZBq7A" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg class = "z-0" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M5 7H19C19.5523 7 20 7.44771 20 8V16C20 16.5523 19.5523 17 19 17H5C4.44772 17 4 16.5523 4 16V8C4 7.44772 4.44772 7 5 7ZM2 8C2 6.34315 3.34315 5 5 5H19C20.6569 5 22 6.34315 22 8V16C22 17.6569 20.6569 19 19 19H5C3.34315 19 2 17.6569 2 16V8ZM10 9L14 12L10 15V9Z" fill="currentColor"/>
            </svg>
        </div>
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.twitter.com/jeffersglass" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" class="ionicon" viewBox="0 0 512 512"><path d="M496 109.5a201.8 201.8 0 01-56.55 15.3 97.51 97.51 0 0043.33-53.6 197.74 197.74 0 01-62.56 23.5A99.14 99.14 0 00348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 002.54 22.1 280.7 280.7 0 01-203-101.3A95.69 95.69 0 0036 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0135.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 01-25.94 3.4 94.38 94.38 0 01-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0139.5 405.6a203 203 0 01-23.5-1.4A278.68 278.68 0 00166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 00496 109.5z" fill="currentColor"/></svg>
        </div>
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.linkedin.com/in/jeffrey-r-glass" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 512 512"><path d="M444.17,32H70.28C49.85,32,32,46.7,32,66.89V441.61C32,461.91,49.85,480,70.28,480H444.06C464.6,480,480,461.79,480,441.61V66.89C480.12,46.7,464.6,32,444.17,32ZM170.87,405.43H106.69V205.88h64.18ZM141,175.54h-.46c-20.54,0-33.84-15.29-33.84-34.43,0-19.49,13.65-34.42,34.65-34.42s33.85,14.82,34.31,34.42C175.65,160.25,162.35,175.54,141,175.54ZM405.43,405.43H341.25V296.32c0-26.14-9.34-44-32.56-44-17.74,0-28.24,12-32.91,23.69-1.75,4.2-2.22,9.92-2.22,15.76V405.43H209.38V205.88h64.18v27.77c9.34-13.3,23.93-32.44,57.88-32.44,42.13,0,74,27.77,74,87.64Z" fill="currentColor"/></svg>
        </div>
    </div>
</div>
</header>
<script>
    const btn = document.querySelector("div.mobile-menu-button")
    const mobileMenu = document.querySelector(".mobile-menu")
    const largeMenu = document.querySelector(".large-menu")
    const socialButtons = document.querySelector(".social-buttons")

    btn.addEventListener("click", () =>{
        openMenu();
    })

    function openMenu() {
        mobileMenu.classList.toggle("hidden");
        largeMenu.classList.toggle("hidden");
        socialButtons.classList.add("hidden");
    }

    
    const smSize = 640;
    const mdSize = 768;
    const largeSize = 1024;
    window.addEventListener('resize', function(event) {
        if (event.target.screen.width > smSize ){
            mobileMenu.classList.add("hidden");
            largeMenu.classList.remove("hidden");
        }
    }, true);
</script>

		<div class="w-full bg-green-800 bg-opacity-10">
			<div class="pt-16"></div>
			<article class="w-full px-16 pt-4 pb-4 m-auto lg:w-11/12 bg-gray-50">
				<h1 class="pb-2 text-4xl">7GUIs Pyscript - Explanations and Details</h1>
				<p>Published May 10, 2022</p>
				
				<div>
					<span>Tags:</span>
					
					<a href="../../tags/python">Python</a>
					
					<a href="../../tags/pyscript">PyScript</a>
					
				</div>
				
				
				<hr>
				<div>
					<script defer src="../../ps/pyscript.js"></script>
<p class="italic post-p">This post is a companion to my project <a href="../../project/the-7-guis-pyscript/">The 7 GUIs in PyScript</a> - I recommend checking out that page first. Viewing on Desktop is highly recommended.</p>
<p class="post-p"><a href="https://eugenkiss.github.io/7guis/tasks/">The Seven Guis</a> is a set of typical challenges in GUI programming. <a href="https://eugenkiss.github.io/7guis/implementations">Implementations abound</a>, in lower-level frameworks like tcl and Qt to modernist frameworks like React and Svelte. Let's see what it takes to implement them in PyScript.</p>

<h2 class="post-h2" id="counter-header">Counter <a target="_blank" href="https://eugenkiss.github.io/7guis/tasks#counter"><img src="../../svg/externallink.svg" alt="" class="inline-block h-6"></a></h2>
<h3 class="italic">"The task is to build a frame containing a label or read-only textfield T and a button B. Initially, the value in T is “0” and each click of B increases the value in T by one." </h3>
<div class="m-4">
    <div class="grid grid-cols-2 p-4 m-auto bg-blue-100 border-2 justify-items-center">
        <label id="counter-target" class="w-full text-center bg-white border-2">Some Placeholder Text</label>
        <py-button id="counter-btn" label="Count" class="">
            def on_click(event):
                add_one()
        </py-button>
        </div>
</div>
<py-script src="counter.py"></py-script>
<p class="post-p">We can break the parts of this initial problem into a few key questions, with answers:
<h4 class="mt-8 text-lg font-semibold">How do buttons works in PyScript</h4>
<p class="post-p">When you add a <span class="font-bold">&lt;py-button&gt;</span> tag to your page, on page-load, PyScript (specifically the code in <a href="https://github.com/pyscript/pyscript/blob/main/pyscriptjs/src/components/pybutton.ts">pybutton.ts</a> adds a &lt;button&gt; tag to the DOM with all the same classes that the py-button tag had. Then, if the Python code inside the py-button tag defines an <code class="code">on_focus</code> or <code class="code">on_click</code> method, callbacks are registered in Javascript to cause those methods to run on focus/click as appropriate.</p>
<p class="post-p">So, to create a "Count" button to increment our counter, we can do something as simple as:</p>
<p class="code-title">my-page.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">&lt;</span>py<span style="color:#f92672">-</span>button<span style="color:#f92672">&gt;</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_click</span>(event):
        add_one()
<span style="color:#f92672">&lt;/</span>py<span style="color:#f92672">-</span>button<span style="color:#f92672">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<h4 class="mt-8 text-lg font-semibold">How do we put output from a script in a specific place on a page?</h4>
<p class="post-p">Of course, we'll need to actually define that <code class="code">add_one</code> function somewhere, to add one to... </p>
<p class="post-p">Well, I guess we'll want somewhere to display the count as well. Lets add a paragraph tag to our HTML code, and give it an id so we can refer to it later: <pre><code class="code">&lt;p id="counter-target"&gt;Some Placeholder Text&lt;/p&gt;</code></pre></p>
<p class="post-p">We could choose to leave the tag empty for now, or perhaps have a "0" there to hide a bit of ugliness as the page loads, but I having placeholder text will give us a clearer view of what's happening when.</p>
<p class="post-p">To actually change the content of our new tag, we can use the <a href="https://github.com/pyscript/pyscript/blob/bc4581d9e50286f0463285f13c015e487831fa0e/pyscriptjs/src/pyscript.py#L110-L129">PyScript.write() function</a>, which takes an <code>element_id</code> as a string, a <code>value</code> to replace/append there (another string), and an optional <code>append</code> argument to tell whether the new content should be appended (as a new div) or replace the existing content.</p>
<p class="post-p">So, to start our count at zero and have it increment each time we press the "Count" button, our code could look something like:</p>
<p class="code-title">myPage.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">&lt;</span>p id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;counter-target&#34;</span><span style="color:#f92672">&gt;</span>Some Placeholder Text<span style="color:#f92672">&lt;/</span>p<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;</span>py<span style="color:#f92672">-</span>button<span style="color:#f92672">&gt;</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_click</span>(event):
        add_one()
<span style="color:#f92672">&lt;/</span>py<span style="color:#f92672">-</span>button<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;</span>br<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;</span>py<span style="color:#f92672">-</span>script src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./counter.py&#34;</span><span style="color:#f92672">&gt;&lt;/</span>py<span style="color:#f92672">-</span>script<span style="color:#f92672">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<h4 class="mt-8 text-lg font-semibold">How do we seperate Python code into external files?</h4>
<p class="post-p">For cleanliness, let's put our code in a separate file called <code>counter.py</code>. To include use this in our html page, we simple use the <code class="code">src</code> attribute of the py-script tag to specify an additional external source. Thus, our complete solution looks like:</p>
<p class="code-title">myPage.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;counter-target&#34;</span>&gt;Some Placeholder Text&lt;/<span style="color:#f92672">p</span>&gt;
&lt;<span style="color:#f92672">py-button</span>&gt;
    def on_click(event):
        add_one()
&lt;/<span style="color:#f92672">py-button</span>&gt;
&lt;<span style="color:#f92672">py-script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;counter.py&#34;</span>&gt;&lt;/<span style="color:#f92672">py-script</span>&gt;</code></pre></td></tr></table>
</div>
</div>
<br>
<p class="code-title">counter.py</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">internalCount <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
target <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;counter-target&#34;</span>
PyScript<span style="color:#f92672">.</span>write(target, str(internalCount), append<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_one</span>():
    <span style="color:#66d9ef">global</span> internalCount
    internalCount <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    PyScript<span style="color:#f92672">.</span>write(target, str(internalCount), append<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)</code></pre></td></tr></table>
</div>
</div>
</p>

<h2 class="mt-12 post-h2 " id="temp-header">Temperature Converter <a target="_blank" href="https://eugenkiss.github.io/7guis/tasks#temp"><img src="../../svg/externallink.svg" alt="" class="inline-block h-6"></a></h2>
<h3 class="italic">"The task is to build a frame containing two textfields TC and TF representing the temperature in Celsius and Fahrenheit, respectively. Initially, both TC and TF are empty. When the user enters a numerical value into TC the corresponding value in TF is automatically updated and vice versa. When the user enters a non-numerical string into TC the value in TF is not updated and vice versa. The formula for converting a temperature C in Celsius into a temperature F in Fahrenheit is C = (F - 32) * (5/9) and the dual direction is F = C * (9/5) + 32." </h3>
<py-script src="./temperature.py"></py-script>
<div class="m-4">
    <div class="grid grid-cols-2 p-4 m-auto bg-blue-100 border-2 justify-items-center">
            <div>
                <h4 class="font-semibold">Fahrenheit</h4>
                <input id = "f-temp" class="w-3/4 bg-white border-4">
            </div>
            <div>
                <h4 class="font-semibold">Celcius</h4>
                <input id="c-temp" class="w-3/4 bg-white border-4">
            </div>
    </div>
</div><p class="post-p">Since we're handle user-inputted text for this project, we'll need to learn a bit about how PyScript interacts with Javascript event listeners. Let's look at a stripped-down example:</p>
<p class="code-title">sample-event-handling.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">&lt;</span>input id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-input&#34;</span> style<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background-color: lightgray;&#34;</span><span style="color:#f92672">&gt;</span>

<span style="color:#f92672">&lt;</span>py<span style="color:#f92672">-</span>script<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> document, console
<span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> create_proxy

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_log_input_to_console</span>(e):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;The value of the input is currently &#34;</span> <span style="color:#f92672">+</span> e<span style="color:#f92672">.</span>target<span style="color:#f92672">.</span>value)

log_input_to_console <span style="color:#f92672">=</span> create_proxy(_log_input_to_console)

document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;my-input&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;input&#34;</span>, log_input_to_console)
<span style="color:#f92672">&lt;/</span>py<span style="color:#f92672">-</span>script<span style="color:#f92672">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<style>
    .instruction-row{
        background-color: rgb(230, 239, 236);
    }
</style>
<div class="grid grid-cols-1 mt-6 gap-y-8 instruction-grid">
    <div class="flex flex-col items-center px-2 lg:flex-row gap-x-4 instruction-row">
        <div class="w-full lg:w-1/2"><div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">&lt;</span>input id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-input&#34;</span> style<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background-color: lightgray;&#34;</span><span style="color:#f92672">&gt;</span></code></pre></td></tr></table>
</div>
</div></div>
        <p class="w-full post-p lg:w-1/2">First, we create the html element we want to target. We'll give it the unique id "my-input" so we can select it later. (You'll probably want a more specific descriptor than this.) The styling is just to make it easier to find on the screen, if you drop just this code into a blank page.</p>
    </div>
    <div class="flex flex-col items-center px-2 lg:flex-row gap-x-4">
        <div class="w-full lg:w-1/2"><div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> document, console
<span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> create_proxy</code></pre></td></tr></table>
</div>
</div></div>
        <p class="w-full post-p lg:w-1/2">Next, we'll import some useful modules. Through some <a href="https://pyodide.org/en/stable/usage/type-conversions.html#type-translations-using-js-obj-from-py">Pyodide dark incantation magic</a>, importing from JS gives us a Python mapping of a Javascript module directly! So now we have access to the JS 'document' and 'console' objects, though we could also <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis">directty import anything in the Javascript global scope</a>. How cool is that.</p>
    </div>
    <div class="flex flex-col items-center px-2 lg:flex-row gap-x-4 instruction-row">
        <div class="w-full lg:w-1/2"><div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_log_input_to_console</span>(e)
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;The value of the input is currently &#34;</span> <span style="color:#f92672">+</span> e<span style="color:#f92672">.</span>target<span style="color:#f92672">.</span>value)
        
log_input_to_console <span style="color:#f92672">=</span> create_proxy(_log_input_to_console)
        
document<span style="color:#f92672">.</span>getElementByID(<span style="color:#e6db74">&#34;my-input&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;input&#34;</span>, log_input_to_console)</code></pre></td></tr></table>
</div>
</div></div>
        <div class="w-full lg:w-1/2">
            <p class="post-p">This is where the real magic happens. We'll define our python function using the usual <code class="code">def functionname():</code> syntax. It will take one parameter, which i've called <code class="code">e</code>, which will be passed the <a href="https://www.w3schools.com/js/js_events.asp">Javascript event</a> that triggered this function. These events have <a href="https://www.w3schools.com/jsref/dom_obj_event.asp">many, many useful properties and methods</a> we can access - in this case, the <code class="code">value</code> property gives us the value of the inputbox that triggered this event.</p>
            <p class="post-p">The trick is, because of <a href="https://pyodide.org/en/stable/usage/type-conversions.html#call-js-from-py">how Pyodide interacts with Javascript promises</a>, we can't just use this Python function as our event handler. We'll need to create a Javascript proxy object for it using create_proxy. This returns a new proxy object that we can use directly as our event handler. (This issue is common enough that its <a href="https://pyodide.org/en/stable/usage/faq.html#how-can-i-use-a-python-function-as-an-event-handler">included in Pyodide's FAQ</a>.</p>
            <p class="post-p">Once we have our proxy object, we can again lean on that magic js-to-python mapping to use Javascript's own <code class="code">querySelector</code> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener">addEventListener</a> methods to add a callback that will run our method whenever the specified event happens - in this case, "input". Note that this is not the "on-" version of the event keywords; that is, it's "input" not "oninput"; "click", not "onclick", and so on.</p>
        </div>
    </div>
</div>
<p class="post-p">And here's that example running live:</p>
<div class="w-full p-4 m-4 bg-blue-100">
    <p class="post-p">Open the developer console and type here: <input id="my-input" class="bg-white border-2 border-gray-700 "></p>
</div>
<py-script>
from js import document, console
from pyodide import create_proxy

def _log_input_to_console(e):
    console.log("The value of the input is currently " + e.target.value)

log_input_to_console = create_proxy(_log_input_to_console)

document.getElementById("my-input").addEventListener("input", log_input_to_console)
</py-script>
<p class="post-p">With this in place, if you type into the inputbox, you should see its contents being output to the console with each keystroke. If you want to have it log (or take any other action) only when the input is submitted/enter is pressed... I think the best option is to wrap the input in a <code class="code">form</code> tag and use the "submit" event to handle it, but I'm not %100 sure what best practice is there.</p>

<p class="post-p">The full code of the Temperature Converter  is as follows:</p>
<p class="mt-4 code-title">my-page.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">py-script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./temperature.py&#34;</span>&gt;&lt;/<span style="color:#f92672">py-script</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid grid-cols-2 p-4 m-auto bg-blue-100 border-2 justify-items-center&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">h4</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;font-semibold&#34;</span>&gt;Fahrenheit&lt;/<span style="color:#f92672">h4</span>&gt;
        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">id </span><span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;f-temp&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-3/4 bg-white border-4&#34;</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">h4</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;font-semibold&#34;</span>&gt;Celcius&lt;/<span style="color:#f92672">h4</span>&gt;
        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;c-temp&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-3/4 bg-white border-4&#34;</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;</code></pre></td></tr></table>
</div>
</div>
<br>
<p class="code-title">temperature.py</p>
<div class="overflow-y-scroll h-124">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> document

<span style="color:#75715e">#This is necessary for reasons I don&#39;t understand</span>
<span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> create_proxy

write_in_progress <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">isTemp</span>(input_temp):
    <span style="color:#66d9ef">try</span>:
        _ <span style="color:#f92672">=</span> float(input_temp)
    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> err:
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
    
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_f</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    <span style="color:#66d9ef">global</span> write_in_progress
    <span style="color:#66d9ef">if</span> write_in_progress:
        <span style="color:#66d9ef">return</span>
    <span style="color:#66d9ef">else</span>:
        write_in_progress <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
        f_input <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;f-temp&#34;</span>)
        c_output <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;c-temp&#34;</span>)
        input_value <span style="color:#f92672">=</span> f_input<span style="color:#f92672">.</span>value
        <span style="color:#66d9ef">if</span> isTemp(input_value):
            c_output<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> round((int(float(input_value)) <span style="color:#f92672">-</span> <span style="color:#ae81ff">32</span>) <span style="color:#f92672">*</span> (<span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">9</span>), <span style="color:#ae81ff">2</span>)
        <span style="color:#66d9ef">else</span>:
            c_output<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        write_in_progress <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_c</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    <span style="color:#66d9ef">global</span> write_in_progress
    <span style="color:#66d9ef">if</span> write_in_progress:
        <span style="color:#66d9ef">return</span>
    <span style="color:#66d9ef">else</span>:
        write_in_progress <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
        c_input <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;c-temp&#34;</span>)
        f_output <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;f-temp&#34;</span>)
        input_value <span style="color:#f92672">=</span> c_input<span style="color:#f92672">.</span>value
        <span style="color:#66d9ef">if</span> isTemp(input_value):
            f_output<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> round((int(float(input_value)) <span style="color:#f92672">*</span> (<span style="color:#ae81ff">9</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)) <span style="color:#f92672">+</span> <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">2</span>)
        <span style="color:#66d9ef">else</span>:
            f_output<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        write_in_progress <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>

f_change <span style="color:#f92672">=</span> create_proxy(_f)
c_change <span style="color:#f92672">=</span> create_proxy(_c)

document<span style="color:#f92672">.</span>querySelector(<span style="color:#e6db74">&#34;#f-temp&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;input&#34;</span>, f_change)
document<span style="color:#f92672">.</span>querySelector(<span style="color:#e6db74">&#34;#c-temp&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;input&#34;</span>, c_change)</code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>

<h2 class="mt-12 post-h2 " id="flight-header">Flight Booker <a target="_blank" href="https://eugenkiss.github.io/7guis/tasks#flight"><img src="../../svg/externallink.svg" alt="" class="inline-block h-6"></a></h2>
<h3 class="italic">"The task is to build a frame containing a combobox C with the two options “one-way flight” and “return flight”, two textfields T1 and T2 representing the start and return date, respectively, and a button B for submitting the selected flight. T2 is enabled iff C’s value is “return flight”. When C has the value “return flight” and T2’s date is strictly before T1’s then B is disabled. When a non-disabled textfield T has an ill-formatted date then T is colored red and B is disabled. When clicking B a message is displayed informing the user of his selection (e.g. “You have booked a one-way flight on 04.04.2014.”). Initially, C has the value “one-way flight” and T1 as well as T2 have the same (arbitrary) date (it is implied that T2 is disabled).</h3>
<py-script src="./flight.py"></py-script>
<div class="m-4">
    <div class="grid grid-rows-4 p-4 bg-blue-100 border-2 justify-items-left">
            <div>
                <select name="flight-mode" id="flight-mode-select">
                    <option value="one">One Way</option>
                    <option value="round">Round Trip</option>
                </select>
            </div>
            <div>
                <h4 class="font-semibold">Departure Date</h4>
                <input id = "dep" class="w-3/4 bg-white border-4">
            </div>
            <div>
                <h4 class="font-semibold">Return Date</h4>
                <input id="ret" class="w-3/4 bg-white border-4">
            </div>
            <div>
                <button id="book-flight" class="p-2 my-2 bg-green-200 border-2 border-gray-400 rounded-lg">Book Flight</button>
                <p id="flight-info" class="italic">Flight Info will go here</p>
            </div>
    </div>
</div>
<p class="post-p">Not too many additional puzzle pieces to fill in here, after the first two examples. We'll make use of the <code class="code">disabled</code> property to control whether the 'return' inputbox is active or not, setting it to <code class="code">true</code> to disable the box. We'll also use the <code class="code">innerText</code> property of the <code class="code">&lt;p&gt;</code> tag at the bottom of the GUI to set its text when the user presses the 'book-flight' button.</p>
<p class="post-p">As mentioned in the <a href="#temperature-header">Temperature Converter section</a>, we cannot call our Python functions directly from event handlers - we'll need to use pyodide.create_proxy to create a Javascript proxy of our function, and have the event trigger that.</p>
<p class="post-p">The full code of this solution is as follows:</p>
<p class="code-title">my-page.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">py-script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./flight.py&#34;</span>&gt;&lt;/<span style="color:#f92672">py-script</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid grid-rows-4 p-4 bg-blue-100 border-2 justify-items-left&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flight-mode&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flight-mode-select&#34;</span>&gt;
            &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;one&#34;</span>&gt;One Way&lt;/<span style="color:#f92672">option</span>&gt;
            &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;round&#34;</span>&gt;Round Trip&lt;/<span style="color:#f92672">option</span>&gt;
        &lt;/<span style="color:#f92672">select</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">h4</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;font-semibold&#34;</span>&gt;Departure Date&lt;/<span style="color:#f92672">h4</span>&gt;
        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">id </span><span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dep&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-3/4 bg-white border-4&#34;</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">h4</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;font-semibold&#34;</span>&gt;Return Date&lt;/<span style="color:#f92672">h4</span>&gt;
        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ret&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-3/4 bg-white border-4&#34;</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;book-flight&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;p-2 my-2 bg-green-200 border-2 border-gray-400 rounded-lg&#34;</span>&gt;Book Flight&lt;/<span style="color:#f92672">button</span>&gt;
        &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flight-info&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;italic&#34;</span>&gt;Flight Info will go here&lt;/<span style="color:#f92672">p</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;</code></pre></td></tr></table>
</div>
</div>
<br>
<p class="code-title">flight.py</p>
<div class="overflow-y-scroll h-124">
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">    <span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> document
    <span style="color:#75715e">#This is necessary for reasons I don&#39;t understand</span>
    <span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> create_proxy
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_flight_mode_change</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        currentMode <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;flight-mode-select&#34;</span>)<span style="color:#f92672">.</span>value
        <span style="color:#66d9ef">if</span> currentMode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;one&#39;</span>:
            document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;ret&#34;</span>)<span style="color:#f92672">.</span>disabled <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
        <span style="color:#66d9ef">else</span>:
            document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;ret&#34;</span>)<span style="color:#f92672">.</span>disabled <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
    
    flight_mode_change <span style="color:#f92672">=</span> create_proxy(_flight_mode_change)
    document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;flight-mode-select&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;input&#34;</span>, flight_mode_change)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_book_flight</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        currentMode <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;flight-mode-select&#34;</span>)<span style="color:#f92672">.</span>value
        departure <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;dep&#34;</span>)<span style="color:#f92672">.</span>value
        return_flight <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;ret&#34;</span>)<span style="color:#f92672">.</span>value
    
        <span style="color:#66d9ef">if</span> currentMode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;one&#39;</span>:
            document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;flight-info&#34;</span>)<span style="color:#f92672">.</span>innerText <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;You&#39;ve booked a one-way flight departing on </span><span style="color:#e6db74">{</span>departure<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
        <span style="color:#66d9ef">else</span>:
            document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;flight-info&#34;</span>)<span style="color:#f92672">.</span>innerText <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;You&#39;ve booked a round-trip flight departing on </span><span style="color:#e6db74">{</span>departure<span style="color:#e6db74">}</span><span style="color:#e6db74"> and returning on </span><span style="color:#e6db74">{</span>return_flight<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
    
    book_flight <span style="color:#f92672">=</span> create_proxy(_book_flight)
    document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;book-flight&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;click&#34;</span>, book_flight)
    
    flight_mode_change()
    
    </code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>

<h2 class="mt-12 post-h2 " id="timer-header">Timer<a target="_blank" href="https://eugenkiss.github.io/7guis/tasks#timer"><img src="../../svg/externallink.svg" alt="" class="inline-block h-6"></a></h2>
<h3 class="italic">The task is to build a frame containing a gauge G for the elapsed time e, a label which shows the elapsed time as a numerical value, a slider S by which the duration d of the timer can be adjusted while the timer is running and a reset button R. Adjusting S must immediately reflect on d and not only when S is released. It follows that while moving S the filled amount of G will (usually) change immediately. When e ≥ d is true then the timer stops (and G will be full). If, thereafter, d is increased such that d > e will be true then the timer restarts to tick until e ≥ d is true again. Clicking R will reset e to zero.</h3>
<div class="m-4">
    <div class="grid grid-rows-4 p-4 m-auto bg-blue-100 border-2 justify-items-start">
        <div class="grid grid-cols-2 justify-items-start">
            <p>Ellapsed Time:</p>
            <progress id="progress-bar" value="32" max="100"> 32% </progress>
        </div>
        <div>
            <p id="seconds">Seconds</p>
        </div>
        <div class="flex flex-row justify-items-center">
            <p>Duration</p>
            <div class="w-full m-auto"><input type="range" min="1" max="100" value="50" id="duration-slider" class="w-72"></div>
        </div>
        <div>
            <button id="reset" class="px-2 my-2 bg-green-200 border-2 border-gray-400 rounded-lg">RESET</button>
        </div>
    </div>
</div>
<p class="post-p">We'll explore a slightly different style of interactivity with this one - using an infinite loop to constantly update the timer as tracked, and update the values of the onscreen label and slider. Before we jump into this infinite loop, we'll set up an event listener to handle pressing the 'reset' button.</p>
<p class="post-p">But note! By doing this, we'll trap the Python interpretter in an infinite loop, and it won't be able to do anything else. Which is fine, so long as you're only running a single "script" on one page... but if you look at the source of this very page, for example, you've notice <code class="code">timer.py</code> is imported at the very end of the <code class="code">body</code> section. Why? Because if we get trapped in an infinite loop at <span class="italic">this point</span> in the page, we'll never even load the following examples!</p>
<p class="post-p">Handily, we don't actually need an separate event handler to handle the changing of the input slider (though that would also be a valid away to do it). Instead, we can directly read the value of the slider each time through out loop using the <code class="code">value</code> property of the slider to get its current value.</p>
<p class="post-p">The full code of this solution is as follows:</p>
<p class="code-title">my-page.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">py-script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;timer.py&#34;</span>&gt;&lt;/<span style="color:#f92672">py-script</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid grid-rows-4 p-4 m-auto bg-blue-100 border-2 justify-items-start&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid grid-cols-2 justify-items-start&#34;</span>&gt;
        &lt;<span style="color:#f92672">p</span>&gt;Ellapsed Time:&lt;/<span style="color:#f92672">p</span>&gt;
        &lt;<span style="color:#f92672">progress</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;progress-bar&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;32&#34;</span> <span style="color:#a6e22e">max</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;100&#34;</span>&gt; 32% &lt;/<span style="color:#f92672">progress</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;seconds&#34;</span>&gt;Seconds&lt;/<span style="color:#f92672">p</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex flex-row justify-items-center&#34;</span>&gt;
        &lt;<span style="color:#f92672">p</span>&gt;Duration&lt;/<span style="color:#f92672">p</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-full m-auto&#34;</span>&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;range&#34;</span> <span style="color:#a6e22e">min</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">max</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;100&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;50&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;duration-slider&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-72&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;reset&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;px-2 my-2 bg-green-200 border-2 rounded-lg&#34;</span>&gt;RESET&lt;/<span style="color:#f92672">button</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;</code></pre></td></tr></table>
</div>
</div>
<br>
<p class="code-title">timer.py</p>
<div class="overflow-y-scroll h-124">
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">import</span> asyncio
<span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> document, console
<span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> create_proxy

my_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
seconds_element <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;seconds&#34;</span>)
duration_slider <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;duration-slider&#34;</span>)
progress_bar <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;progress-bar&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_reset_time</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;Time reset&#34;</span>)
    <span style="color:#66d9ef">global</span> my_time
    my_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

reset_time <span style="color:#f92672">=</span> create_proxy(_reset_time)
document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;reset&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;click&#34;</span>, reset_time)

<span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
    <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">.1</span>)
    my_time <span style="color:#f92672">=</span> round(my_time <span style="color:#f92672">+</span> <span style="color:#ae81ff">.1</span>, <span style="color:#ae81ff">2</span>)
    seconds_element<span style="color:#f92672">.</span>innerText <span style="color:#f92672">=</span> str(my_time) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Seconds&#34;</span>

    min_time <span style="color:#f92672">=</span> int(duration_slider<span style="color:#f92672">.</span>min)
    max_time <span style="color:#f92672">=</span> int(duration_slider<span style="color:#f92672">.</span>value)

    min_bar <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    max_bar <span style="color:#f92672">=</span> int(progress_bar<span style="color:#f92672">.</span>max)

    progress_bar<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> ((my_time <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">-</span> min_time) <span style="color:#f92672">*</span> (max_bar <span style="color:#f92672">-</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">/</span> (max_time <span style="color:#f92672">-</span> min_time <span style="color:#f92672">+</span> <span style="color:#ae81ff">.01</span>)</code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>

<h2 class="mt-12 post-h2 " id="crud-header">CRUD<a target="_blank" href="https://eugenkiss.github.io/7guis/tasks#timer"><img src="../../svg/externallink.svg" alt="" class="inline-block h-6"></a></h2>
<h3 class="italic">The task is to build a frame containing the following elements: a textfield Tprefix, a pair of textfields Tname and Tsurname, a listbox L, buttons BC, BU and BD and the three labels as seen in the screenshot. L presents a view of the data in the database that consists of a list of names. At most one entry can be selected in L at a time. By entering a string into Tprefix the user can filter the names whose surname start with the entered prefix—this should happen immediately without having to submit the prefix with enter. Clicking BC will append the resulting name from concatenating the strings in Tname and Tsurname to L. BU and BD are enabled iff an entry in L is selected. In contrast to BC, BU will not append the resulting name but instead replace the selected entry with the new name. BD will remove the selected entry. The layout is to be done like suggested in the screenshot. In particular, L must occupy all the remaining space.</h3>
<py-script src="./crud.py"></py-script>
<div class="m-4">
    <div class="grid p-4 m-auto bg-blue-100 border-2 justify-items-start">
        <div class="p-2 m-auto bg-gray-300 rounded-lg">
            <div id="upper-content" class="grid ">
                <div id="filter-box" class="grid w-full grid-cols-2">
                    <p id="filter-label" class="px-4">Filter Prefix:
                    <input type="text" id="filter-input" class="border-2 border-gray-300"></p>
                </div>
                <div id="middle-section" class="grid grid-cols-2">
                    <select id="listbox" size="5" class="h-48 m-4 bg-blue-50">test</select>
                    <div id="name-entry-container" class="grid grid-rows-2 w-96">
                        <div id="firstname-container" class="grid h-8 grid-cols-2 align-middle justify-items-end">
                            <p>Name:</p>
                            <input type="text" id="firstname-input">
                        </div>
                        <div id="surname-container" class="grid h-8 grid-cols-2 align-middle justify-items-end">
                            <p>Surname:</p>
                            <input type="text" id="surname-input">
                        </div>
                    </div>
                </div>
            </div>
            <div id="lower-buttons" class="grid w-full grid-cols-3">
                <button id="create" class="m-4 bg-green-200 border-2 border-gray-400 rounded-md">Create</button>
                <button id="update" class="m-4 bg-green-200 border-2 border-gray-400 rounded-md">Update</button>
                <button id="delete" class="m-4 bg-green-200 border-2 border-gray-400 rounded-md">Delete</button>
            </div>
        </div>
    </div>
</div>
<p class="post-p">This is the first challenge where we get to play a little bit with DOM manipulation. So far we've only been reading/manipulating the values of inputs and textboxes - now we'll actually add and remove elements.</p>
<p class="post-p">To do this, we'll use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement">document.creteElement()</a> method, which takes a tag name as a string (like <code class="code">p</code> or <code class="code">div</code>) and creates a tag of that type. We can then set the <code class="code">value</code> of that tag (if appropriate for an input-like object), its <code class="code">text</code>, <code class="code">innerHTML</code>, and so on. We can then add that tag as a child of an existing DOM element by calling <code class="code">myOtherElement.appendChild(myNewTagElement)</code>.</p>
<p class="post-p">I will admit to somewhat brute-forcing the issue removal and replacement of 'database' entries by wiping the list view of all entries and re-displaying them each time the user takes an action the modifies the list. This is certainly not the most efficient way to handle things. For a better example of managing the state of a list of objects, see the <a href="#circle-header">Circle Drawer example</a>.</p>
<p class="post-p">I also took the opportunity to introduce <a href="https://docs.python.org/3/library/dataclasses.html">Dataclasses</a> here, a really useful tool if you haven't encountered them before. They really simply small container classes - no more writing <code class="code">__str__</code>, <code class="code">__repr__</code>, or even <code class="code">__init__</code> by hand! There's a <a href="https://www.youtube.com/watch?v=vBH6GRJ1REM">great video about Dataclasses from mCoding</a> the explains this in greater detail.</p>
<p class="post-p">The full code of this solution is as follows:</p>
<p class="code-title">my-page.html</p>
<div class="overflow-y-scroll h-124">
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">    &lt;<span style="color:#f92672">py-script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./crud.py&#34;</span>&gt;&lt;/<span style="color:#f92672">py-script</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid p-4 m-auto bg-blue-100 border-2 justify-items-start&#34;</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;p-2 m-auto bg-green-100 rounded-lg&#34;</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upper-content&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid &#34;</span>&gt;
                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;filter-box&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid w-full grid-cols-2&#34;</span>&gt;
                    &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;filter-label&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;px-4&#34;</span>&gt;Filter Prefix:
                    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;filter-input&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-2 border-gray-300&#34;</span>&gt;&lt;/<span style="color:#f92672">p</span>&gt;
                &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;middle-section&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid grid-cols-2&#34;</span>&gt;
                    &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;listbox&#34;</span> <span style="color:#a6e22e">size</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;5&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;h-48 m-4 bg-blue-50&#34;</span>&gt;test&lt;/<span style="color:#f92672">select</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;name-entry-container&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid grid-rows-2 w-96&#34;</span>&gt;
                        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;firstname-container&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid h-8 grid-cols-2 align-middle justify-items-end&#34;</span>&gt;
                            &lt;<span style="color:#f92672">p</span>&gt;Name:&lt;/<span style="color:#f92672">p</span>&gt;
                            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;firstname-input&#34;</span>&gt;
                        &lt;/<span style="color:#f92672">div</span>&gt;
                        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;surname-container&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid h-8 grid-cols-2 align-middle justify-items-end&#34;</span>&gt;
                            &lt;<span style="color:#f92672">p</span>&gt;Surname:&lt;/<span style="color:#f92672">p</span>&gt;
                            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;surname-input&#34;</span>&gt;
                        &lt;/<span style="color:#f92672">div</span>&gt;
                    &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;/<span style="color:#f92672">div</span>&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lower-buttons&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid w-full grid-cols-3&#34;</span>&gt;
                &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;create&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;m-4 bg-gray-200 border-2 border-gray-400 rounded-md&#34;</span>&gt;Create&lt;/<span style="color:#f92672">button</span>&gt;
                &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;update&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;m-4 bg-gray-200 border-2 border-gray-400 rounded-md&#34;</span>&gt;Update&lt;/<span style="color:#f92672">button</span>&gt;
                &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;delete&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;m-4 bg-gray-200 border-2 border-gray-400 rounded-md&#34;</span>&gt;Delete&lt;/<span style="color:#f92672">button</span>&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
        &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;</code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>
<br>
<p class="code-title">crud.py</p>
<div class="overflow-y-scroll h-124">
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> console
<span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> create_proxy
<span style="color:#f92672">from</span> dataclasses <span style="color:#f92672">import</span> dataclass, field
<span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> UserList
<span style="color:#f92672">from</span> random <span style="color:#f92672">import</span> randint

<span style="color:#a6e22e">@dataclass</span>(order<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Entry</span>():
    surname: str    
    firstname: str

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EntryList</span>(UserList):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">append</span>(self, other):
        super()<span style="color:#f92672">.</span>append(other)
        self<span style="color:#f92672">.</span>data <span style="color:#f92672">=</span> sorted(self<span style="color:#f92672">.</span>data)

entries <span style="color:#f92672">=</span> EntryList()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_namefields</span>():
    first <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;firstname-input&#34;</span>)<span style="color:#f92672">.</span>value
    sur <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;surname-input&#34;</span>)<span style="color:#f92672">.</span>value
    <span style="color:#66d9ef">return</span> first, sur

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_update_view</span>():
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;Updating listbox view&#34;</span>)
    list <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;listbox&#34;</span>)
    list<span style="color:#f92672">.</span>innerHTML <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>

    filter_text <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;filter-input&#34;</span>)<span style="color:#f92672">.</span>value
    <span style="color:#66d9ef">if</span> filter_text <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>: filter <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
    <span style="color:#66d9ef">else</span>: filter <span style="color:#f92672">=</span> filter_text

    <span style="color:#66d9ef">for</span> entry <span style="color:#f92672">in</span> entries:
        <span style="color:#66d9ef">if</span> filter <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> entry<span style="color:#f92672">.</span>surname<span style="color:#f92672">.</span>startswith(filter):
            option <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>createElement(<span style="color:#e6db74">&#39;option&#39;</span>)
            option<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> entry<span style="color:#f92672">.</span>firstname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#f92672">+</span> entry<span style="color:#f92672">.</span>surname
            option<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> entry<span style="color:#f92672">.</span>firstname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#f92672">+</span> entry<span style="color:#f92672">.</span>surname
            list<span style="color:#f92672">.</span>appendChild(option)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_create_entry</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;Create clicked&#34;</span>)
    first, sur <span style="color:#f92672">=</span> _get_namefields()
    new_entry <span style="color:#f92672">=</span> Entry(firstname <span style="color:#f92672">=</span> first, surname <span style="color:#f92672">=</span> sur)
    entries<span style="color:#f92672">.</span>append(new_entry)
    _update_view()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_delete_entry</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;Delete clicked&#34;</span>)
    list <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;listbox&#34;</span>)
    index <span style="color:#f92672">=</span> list<span style="color:#f92672">.</span>selectedIndex
    
    <span style="color:#66d9ef">if</span> index <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>:
        entries<span style="color:#f92672">.</span>pop(index)
        _update_view()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_update_entry</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    list <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;listbox&#34;</span>)
    index <span style="color:#f92672">=</span> list<span style="color:#f92672">.</span>selectedIndex

    <span style="color:#66d9ef">if</span> index <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>:
        entries<span style="color:#f92672">.</span>pop(index)
        _create_entry()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_filter_key</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;Filter input changed&#34;</span>)
    _update_view()

create_entry <span style="color:#f92672">=</span> create_proxy(_create_entry)
delete_entry <span style="color:#f92672">=</span> create_proxy(_delete_entry)
update_entry <span style="color:#f92672">=</span> create_proxy(_update_entry)
filter_key <span style="color:#f92672">=</span> create_proxy(_filter_key)

document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;create&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;click&#34;</span>, create_entry)
document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;delete&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;click&#34;</span>, delete_entry)
document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;update&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;click&#34;</span>, update_entry)

document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;filter-input&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;input&#34;</span>, filter_key)
    </code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>

<h2 class="mt-12 post-h2 " id="circle-header">Circle Drawer<a target="_blank" href="https://eugenkiss.github.io/7guis/tasks#circle"><img src="../../svg/externallink.svg" alt="" class="inline-block h-6"></a></h2>
<h3 class="italic">The task is to build a frame containing an undo and redo button as well as a canvas area underneath. Left-clicking inside an empty area inside the canvas will create an unfilled circle with a fixed diameter whose center is the left-clicked point. The circle nearest to the mouse pointer such that the distance from its center to the pointer is less than its radius, if it exists, is filled with the color gray. The gray circle is the selected circle C. Right-clicking C will make a popup menu appear with one entry “Adjust diameter..”. Clicking on this entry will open another frame with a slider inside that adjusts the diameter of C. Changes are applied immediately. Closing this frame will mark the last diameter as significant for the undo/redo history. Clicking undo will undo the last significant change (i.e. circle creation or diameter adjustment). Clicking redo will reapply the last undoed change unless new changes were made by the user in the meantime.</h3>
<div class="grid p-4 m-auto bg-blue-100 border-2">
    <canvas id="circle-canvas" width="500" height="500" class="m-auto border-2" ></canvas>
    <div id="button-holder" class="flex w-full mt-2 justify-evenly"><button id="undo" class="px-6 bg-green-200 border-2 border-gray-400 rounded-lg">Undo</button><button id="redo" class="px-6 bg-green-200 border-2 border-gray-400 rounded-lg">Redo</button></div>
</div>
<link rel ="stylesheet" type="text/css" href="./context-menu.css">
<div id="right-click-menu" class="absolute bg-gray-200 border-1" 
    style="display: none">
    <div class="mx-4 my-2">
        <p id="circle-slider-label">Adjust diameter of Circle at (x, y)</p>
        <div class="w-full m-auto"><input type="range" min="1" max="100" value="50" id="circle-slider" class="w-5/6"></div>
    </div>
</div>
<py-script src="circle.py"></py-script>
<p class="post-p">Oh boy we get to play with the canvas! There are almost-certainly Javascript libraries for handling onscreen objects as sprites, with undo-redo perhaps, but the whole point of this challenge is to learn by doing. So I'll start with a bare canvas object and work up from there.</p>
<p class="post-p">When thinking about a somewhat-involved challenge like this, it's useful to break it down into managable chunks. I figured I'd get circles being drawn with a mouse-click, then figure out the right-click-to-change-size functionality, then work on undo/redo.</p>
<p class="post-p">Thanks again to Pyodide's marvelous JS-to-Python mapping, we can directly use all the methods available in the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D">CanvasRenderingContext2D</a> object to draw to our existing canvas. The <code class="code">arc</code> method is perfect for drawing circles, and <code class="code">stroke</code> or <code class="code">fill</code> actually place the drawn strokes on the canvas.</p>
<p class="post-p">With just those simple functions in place, if we hook up an eventListener to listen for the <code class="code">mousedown</code> event, which relies on our _draw_circle function, we can pretty quickly begin clicking away:</p>
<p class="code-title">canvas-context-examples.py</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">canvas <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-canvas&#34;</span>)
ctx <span style="color:#f92672">=</span> canvas<span style="color:#f92672">.</span>getContext(<span style="color:#e6db74">&#34;2d&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_clear_screen</span>():
    ctx<span style="color:#f92672">.</span>fillStyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>
    ctx<span style="color:#f92672">.</span>fillRect(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>, canvas<span style="color:#f92672">.</span>width, canvas<span style="color:#f92672">.</span>height)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_draw_circle</span>(x, y, radius):
    ctx<span style="color:#f92672">.</span>beginPath();
    ctx<span style="color:#f92672">.</span>arc(x, y, radius, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>pi)
    ctx<span style="color:#f92672">.</span>stroke()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_draw_filled_circle</span>(x, y, radius):
    ctx<span style="color:#f92672">.</span>beginPath();
    ctx<span style="color:#f92672">.</span>arc(x, y, radius, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>pi)
    ctx<span style="color:#f92672">.</span>fillStyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gray&#34;</span>
    ctx<span style="color:#f92672">.</span>fill()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_on_click</span>(e):
    <span style="color:#66d9ef">if</span> e<span style="color:#f92672">.</span>button <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>: <span style="color:#75715e">#left mouse button</span>
        _make_new_circle(e<span style="color:#f92672">.</span>offsetX,e<span style="color:#f92672">.</span>offsetY, randint(<span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">70</span>))

on_click <span style="color:#f92672">=</span> create_proxy(_on_click)

document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-canvas&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;mousedown&#34;</span>, on_click)</code></pre></td></tr></table>
</div>
</div>
<p class="post-p">As far as handling the custom right-click menu, I found <a href="https://www.geeksforgeeks.org/how-to-add-a-custom-right-click-menu-to-a-webpage/">this guide from geeksforgeeks</a> to be useful. Basically, you create a <code class="code">div</code> somewhere on your page that holds the contents of your new menu. Then you set its style to <code class="code">display:none</code> so it doesn't actually appear. When you want it to show up, to change its <code class="code">left</code> and <code class="code">top</code> properties to match the current position of the mouse and set its display stlye to <code class="code">block</code>. Voila, the div appears where you clicked.</p>
<p class="post-p">The nice thing about handing the menu as a div (as opposed to, say, defining our own custom piece of interactive GUI) is that we can make use of all the functionality that native HTML elements provide already. Our menu can have labels, inputs of any kind, even addtional canvases.</p>
<p class="post-p">There's a little extra legwork to do to make sure that the browser's native right-click menu doesn't also appear. With <code class="code">e</code> as the event that the eventListener passed to our function, we can prevent the default right-click menu from opening by calling <code class="code">e.preventDefault()</code>, <code class="code">e.stopPropagation()</code>, and returning <code class="code">false</code> from our handler function.</p>
<p class="post-p">Finally, for the undo/redo functionality, we need to actually start tracking our circles as objects. This is the point when Circle became a Dataclass in the code. We also need to track the changes-in-diameter that are made to the circles, so a ResizeOperation Dataclass was born. Each time the user takes an action, a new object (Circle or ResizeOperation) is appended to a list of actions, and a pointer to the most-recent action is incremented by one. When the user presses undo, if the pointed-to action is a ResizeOperation, we reverse the resizing of the appropriate Circle, and either way, the pointer is decremented by 1. We then set the rendering function to only draw circles that exist earlier than our pointer in our list of actions. A redo operation is similar, resizing circles as necessary and incrementing the pointer. Finally, we adjust out functions for drawing new circles and resizing them to always truncate the list of actions after the current point, and set the pointer to the end of our list of actions.</p>
<p class="post-p">If the preceding paragaph was just so much word-spaghetti, the full code of this solution is as follows:</p>
<p class="code-title">my-page.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">py-script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;circle.py&#34;</span>&gt;&lt;/<span style="color:#f92672">py-script</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid p-4 m-auto bg-blue-100 border-2&#34;</span>&gt;
    &lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;circle-canvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;500&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;500&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;m-auto border-2&#34;</span> &gt;&lt;/<span style="color:#f92672">canvas</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button-holder&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex w-full mt-2 justify-evenly&#34;</span>&gt;&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;undo&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;px-6 bg-green-200 border-2 rounded-lg&#34;</span>&gt;Undo&lt;/<span style="color:#f92672">button</span>&gt;&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;redo&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;px-6 bg-green-200 border-2 rounded-lg&#34;</span>&gt;Redo&lt;/<span style="color:#f92672">button</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;

&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel </span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./context-menu.css&#34;</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;right-click-menu&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;absolute bg-gray-200 border-1&#34;</span> 
    <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;display: none&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mx-4 my-2&#34;</span>&gt;
        &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;circle-slider-label&#34;</span>&gt;Adjust diameter of Circle at (x, y)&lt;/<span style="color:#f92672">p</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-full m-auto&#34;</span>&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;range&#34;</span> <span style="color:#a6e22e">min</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">max</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;100&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;50&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;circle-slider&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-5/6&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;</code></pre></td></tr></table>
</div>
</div>
<br>
<p class="code-title">circle.py</p>
<div class="overflow-y-scroll h-124">
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> document, console, window
<span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> pi, sqrt
<span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> create_proxy
<span style="color:#f92672">from</span> random <span style="color:#f92672">import</span> randint
<span style="color:#f92672">from</span> dataclasses <span style="color:#f92672">import</span> dataclass, field

canvas <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-canvas&#34;</span>)
ctx <span style="color:#f92672">=</span> canvas<span style="color:#f92672">.</span>getContext(<span style="color:#e6db74">&#34;2d&#34;</span>)
<span style="color:#75715e">#Fill background with white</span>
ctx<span style="color:#f92672">.</span>fillStyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>
ctx<span style="color:#f92672">.</span>fillRect(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>, canvas<span style="color:#f92672">.</span>width, canvas<span style="color:#f92672">.</span>height)

<span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Circle</span>():
    x: int
    y: int
    radius: int

<span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UndoQueue</span>:
    index : int
    q : list() <span style="color:#f92672">=</span> field(default_factory <span style="color:#f92672">=</span> list)

<span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResizeOperation</span>:
    circle: Circle
    previous_size: int
    new_size: int

uq <span style="color:#f92672">=</span> UndoQueue(index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
currentResize <span style="color:#f92672">=</span> ResizeOperation(<span style="color:#66d9ef">None</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)

my_circles <span style="color:#f92672">=</span> list()
closest_circle_index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_clear_screen</span>():
    ctx<span style="color:#f92672">.</span>fillStyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>
    ctx<span style="color:#f92672">.</span>fillRect(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>, canvas<span style="color:#f92672">.</span>width, canvas<span style="color:#f92672">.</span>height)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_draw_circle</span>(x, y, radius):
    ctx<span style="color:#f92672">.</span>beginPath();
    ctx<span style="color:#f92672">.</span>arc(x, y, radius, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>pi)
    ctx<span style="color:#f92672">.</span>stroke()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_draw_filled_circle</span>(x, y, radius):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Drawing filled circle at </span><span style="color:#e6db74">{</span>x<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>y<span style="color:#e6db74">}</span><span style="color:#e6db74">, with radius </span><span style="color:#e6db74">{</span>radius<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
    
    ctx<span style="color:#f92672">.</span>beginPath();
    ctx<span style="color:#f92672">.</span>arc(x, y, radius, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>pi)
    ctx<span style="color:#f92672">.</span>fillStyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gray&#34;</span>
    ctx<span style="color:#f92672">.</span>fill()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_redraw_all</span>():
    _clear_screen()
    <span style="color:#66d9ef">if</span> len(my_circles):
        <span style="color:#66d9ef">if</span> closest_circle_index <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>:
            c <span style="color:#f92672">=</span> my_circles[closest_circle_index]
            _draw_filled_circle(c<span style="color:#f92672">.</span>x, c<span style="color:#f92672">.</span>y, c<span style="color:#f92672">.</span>radius)
        <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> my_circles:
            _draw_circle(c<span style="color:#f92672">.</span>x, c<span style="color:#f92672">.</span>y, c<span style="color:#f92672">.</span>radius)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_make_new_circle</span>(x, y, radius):
    new_circle <span style="color:#f92672">=</span> Circle(x, y, radius)
    my_circles<span style="color:#f92672">.</span>append(new_circle)

    uq<span style="color:#f92672">.</span>q <span style="color:#f92672">=</span> uq<span style="color:#f92672">.</span>q[:uq<span style="color:#f92672">.</span>index<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
    uq<span style="color:#f92672">.</span>q<span style="color:#f92672">.</span>append(new_circle)
    uq<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> len(uq<span style="color:#f92672">.</span>q) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>uq<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_on_click</span>(e):
    <span style="color:#66d9ef">global</span> my_circles
    console<span style="color:#f92672">.</span>log(str(e<span style="color:#f92672">.</span>offsetX) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> str(e<span style="color:#f92672">.</span>offsetY))
    <span style="color:#66d9ef">if</span> (document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;right-click-menu&#34;</span>)<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>display <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;block&#34;</span>): _hide_menu(e)
    <span style="color:#66d9ef">if</span> e<span style="color:#f92672">.</span>button <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>: <span style="color:#75715e">#left mouse button</span>
        _make_new_circle(e<span style="color:#f92672">.</span>offsetX,e<span style="color:#f92672">.</span>offsetY, randint(<span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">70</span>))
        _redraw_all()
    <span style="color:#66d9ef">else</span>:
        <span style="color:#75715e">#if (document.getElementById(&#34;right-click-menu&#34;).style.display == &#34;block&#34;): _hide_menu(e)</span>
        <span style="color:#66d9ef">if</span> closest_circle_index <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>: _show_menu(e)
        e<span style="color:#f92672">.</span>preventDefault()
        e<span style="color:#f92672">.</span>stopPropagation()
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_no_context</span>(e):
    e<span style="color:#f92672">.</span>preventDefault()
    e<span style="color:#f92672">.</span>stopPropagation()
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>

canvas<span style="color:#f92672">.</span>oncontextmenu <span style="color:#f92672">=</span> _no_context
document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;right-click-menu&#34;</span>)<span style="color:#f92672">.</span>oncontextmenu <span style="color:#f92672">=</span> _no_context

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_show_menu</span>(event):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;Right mouse button clicked, showing menu&#34;</span>)
    menu <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;right-click-menu&#34;</span>)
    menu<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>display <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;block&#34;</span>
    menu<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>left <span style="color:#f92672">=</span> str(event<span style="color:#f92672">.</span>pageX) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;px&#34;</span>
    menu<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>top <span style="color:#f92672">=</span> str(event<span style="color:#f92672">.</span>pageY) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;px&#34;</span>

    c <span style="color:#f92672">=</span> my_circles[closest_circle_index]

    label <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-slider-label&#34;</span>)
    label<span style="color:#f92672">.</span>innerText <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Adjust diameter of Circle at (</span><span style="color:#e6db74">{</span>c<span style="color:#f92672">.</span>x<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>c<span style="color:#f92672">.</span>y<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>

    slider <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-slider&#34;</span>)
    slider<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> my_circles[closest_circle_index]<span style="color:#f92672">.</span>radius
    <span style="color:#66d9ef">global</span> currentResize
    currentResize<span style="color:#f92672">.</span>previous_size <span style="color:#f92672">=</span> slider<span style="color:#f92672">.</span>value
    currentResize<span style="color:#f92672">.</span>circle <span style="color:#f92672">=</span> c

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_change_radius</span>(_):
    slider <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-slider&#34;</span>)
    new_radius <span style="color:#f92672">=</span> slider<span style="color:#f92672">.</span>value
    my_circles[closest_circle_index]<span style="color:#f92672">.</span>radius <span style="color:#f92672">=</span> new_radius
    _redraw_all()
    

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_hide_menu</span>(e):
    slider <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-slider&#34;</span>)
    <span style="color:#66d9ef">global</span> currentResize
    currentResize<span style="color:#f92672">.</span>new_size <span style="color:#f92672">=</span> slider<span style="color:#f92672">.</span>value

    uq<span style="color:#f92672">.</span>q <span style="color:#f92672">=</span> uq<span style="color:#f92672">.</span>q[:uq<span style="color:#f92672">.</span>index<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
    uq<span style="color:#f92672">.</span>q<span style="color:#f92672">.</span>append(currentResize)
    uq<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> len(uq<span style="color:#f92672">.</span>q) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>

    currentResize <span style="color:#f92672">=</span> ResizeOperation(<span style="color:#66d9ef">None</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)
    document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;right-click-menu&#34;</span>)<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>display <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;none&#34;</span>
    _recalc_nearest_circle(e<span style="color:#f92672">.</span>offsetX, e<span style="color:#f92672">.</span>offsetY)
        
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_on_move</span>(e):
    <span style="color:#75715e">#Do not reselect circle when menu is open</span>
    <span style="color:#66d9ef">if</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;right-click-menu&#34;</span>)<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>display <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;block&#34;</span>: <span style="color:#66d9ef">return</span> 
    <span style="color:#66d9ef">if</span> len(my_circles):
        _recalc_nearest_circle(e<span style="color:#f92672">.</span>offsetX, e<span style="color:#f92672">.</span>offsetY)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_recalc_nearest_circle</span>(mouse_x, mouse_y):
        closest_index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
        closest_distance <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000</span>
        <span style="color:#66d9ef">for</span> i, c <span style="color:#f92672">in</span> enumerate(my_circles):
            dist <span style="color:#f92672">=</span> sqrt((mouse_x <span style="color:#f92672">-</span> c<span style="color:#f92672">.</span>x) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> (mouse_y <span style="color:#f92672">-</span> c<span style="color:#f92672">.</span>y) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>)
            <span style="color:#66d9ef">if</span> dist <span style="color:#f92672">&lt;</span> closest_distance: 
                closest_index <span style="color:#f92672">=</span> i
                closest_distance <span style="color:#f92672">=</span> dist
        
        <span style="color:#66d9ef">global</span> closest_circle_index
        <span style="color:#66d9ef">if</span> closest_index <span style="color:#f92672">!=</span> closest_circle_index:
            closest_circle_index <span style="color:#f92672">=</span> closest_index
            _redraw_all()

on_click <span style="color:#f92672">=</span> create_proxy(_on_click)
on_move <span style="color:#f92672">=</span> create_proxy(_on_move)
change_radius <span style="color:#f92672">=</span> create_proxy(_change_radius)

document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-canvas&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;mousedown&#34;</span>, on_click)
document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-canvas&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;mousemove&#34;</span>, on_move)
document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;circle-slider&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;input&#34;</span>, change_radius)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_press_undo</span>(e):
    <span style="color:#66d9ef">if</span> uq<span style="color:#f92672">.</span>index <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
        console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Nothing more to undo</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">{</span>uq<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
        <span style="color:#66d9ef">return</span>

    op_to_undo <span style="color:#f92672">=</span> uq<span style="color:#f92672">.</span>q[uq<span style="color:#f92672">.</span>index]
    <span style="color:#66d9ef">if</span> type(op_to_undo) <span style="color:#f92672">==</span> Circle:
        my_circles<span style="color:#f92672">.</span>pop()
        uq<span style="color:#f92672">.</span>index <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
        <span style="color:#66d9ef">if</span> len(my_circles):
            _recalc_nearest_circle(<span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">500</span>) <span style="color:#75715e">#A hack, bottom of the canvas</span>
        _redraw_all()
    <span style="color:#66d9ef">elif</span> type(op_to_undo) <span style="color:#f92672">==</span> ResizeOperation:
        op_to_undo<span style="color:#f92672">.</span>circle<span style="color:#f92672">.</span>radius <span style="color:#f92672">=</span> op_to_undo<span style="color:#f92672">.</span>previous_size
        uq<span style="color:#f92672">.</span>index <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
        _redraw_all()
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;After Undo </span><span style="color:#e6db74">{</span>uq<span style="color:#e6db74">}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">{</span>my_circles<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_press_redo</span>(e):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;REDO </span><span style="color:#e6db74">{</span>uq<span style="color:#e6db74">}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">{</span>my_circles<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
    <span style="color:#66d9ef">if</span> uq<span style="color:#f92672">.</span>index <span style="color:#f92672">==</span> len(uq<span style="color:#f92672">.</span>q) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>: 
        console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Nothing more to redo</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">{</span>uq<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
        <span style="color:#66d9ef">return</span>

    op_to_redo <span style="color:#f92672">=</span> uq<span style="color:#f92672">.</span>q[uq<span style="color:#f92672">.</span>index<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
    <span style="color:#66d9ef">if</span> type(op_to_redo) <span style="color:#f92672">==</span> Circle:
        my_circles<span style="color:#f92672">.</span>append(Circle(op_to_redo<span style="color:#f92672">.</span>x, op_to_redo<span style="color:#f92672">.</span>y, op_to_redo<span style="color:#f92672">.</span>radius))
        uq<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">elif</span> type(op_to_redo) <span style="color:#f92672">==</span> ResizeOperation:
        op_to_redo<span style="color:#f92672">.</span>circle<span style="color:#f92672">.</span>radius <span style="color:#f92672">=</span> op_to_redo<span style="color:#f92672">.</span>new_size
        uq<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">if</span> len(my_circles):
        _recalc_nearest_circle(<span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">500</span>)   

    _redraw_all()
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;After Redo </span><span style="color:#e6db74">{</span>uq<span style="color:#e6db74">}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">{</span>my_circles<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)


press_undo <span style="color:#f92672">=</span> create_proxy(_press_undo)
press_redo <span style="color:#f92672">=</span> create_proxy(_press_redo)

document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;undo&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;click&#34;</span>, press_undo)
document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;redo&#34;</span>)<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;click&#34;</span>, press_redo)</code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>

<h2 class="mt-12 post-h2 " id="cells-header">Spreadsheet<a target="_blank" href="https://eugenkiss.github.io/7guis/tasks#cells"><img src="../../svg/externallink.svg" alt="" class="inline-block h-6"></a></h2>
<h3 class="italic">The task is to create a simple but usable spreadsheet application. The spreadsheet should be scrollable. The rows should be numbered from 0 to 99 and the columns from A to Z. Double-clicking a cell C lets the user change C’s formula. After having finished editing the formula is parsed and evaluated and its updated value is shown in C. In addition, all cells which depend on C must be reevaluated. This process repeats until there are no more changes in the values of any cell (change propagation). Note that one should not just recompute the value of every cell but only of those cells that depend on another cell’s changed value. If there is an already provided spreadsheet widget it should not be used. Instead, another similar widget (like JTable in Swing) should be customized to become a reusable spreadsheet widget.</h3>
<link rel ="stylesheet" type="text/css" href="./cells-table.css">
            <div class="grid w-full p-4 m-auto bg-blue-100 border-2 rounded-md">
                <div id="spreadsheet-wrapper" class="overflow-x-auto overflow-y-auto h-72">
                    <table id="spreadsheet" style="empty-cells:show" class="m-auto bg-white border-2">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
<py-env>
- paths:
    - ./spreadsheet.py
    - ./formula_parser.py
</py-env>
<py-script src="./cells-table.py">
</py-script>
<p class="post-p">I will entirely own to not-quite-finishing this challenge, in that I didn't actually implement the 'cells-can-refer-to-other-cells' component of it that actually makes it a Spreadsheet and not a big grid of calculators. Ah well, perhaps you'll forgive me. <span class="font-bold">The error handling is also quite bad.</span></p>
<p class="post-p">This is the first time I've had cause to use the <code class="code">&lt;py-env&gt;</code> tag in these challenges. This takes a toml-style list of additional modules to import from PYPI (via <a href="https://pyodide.org/en/stable/usage/loading-packages.html">micropip</a>), as well as a list of additional local paths that one can import from. In my case, I broke out my code into a couple of additional Python files, so my <code class="code">&lt;py-env&gt;</code> tag looked like this:</p>
<p class="code-title">py-env-example.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">py-env</span>&gt;
- paths:
    - ./spreadsheet.py
    - ./formula_parser.py
&lt;/<span style="color:#f92672">py-env</span>&gt;
&lt;<span style="color:#f92672">py-script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./cells-table.py&#34;</span>&gt;
&lt;/<span style="color:#f92672">py-script</span>&gt;</code></pre></td></tr></table>
</div>
</div>
<br>
<p class="post-p">I could spend a whole post talking about the logic in <code class="code">formula-parser.py</code>, but since this is really more of a PyScript adventure and not so much just Python, I'll leave you to explore that code on your own if you're interested. Let's talk about the setup/HTML parts.</p>
<p class="post-p">The grid cells themselves are all <code class="code">input</code> tags, which are generated at runtime by the <code class="code">create_cells()</code> function. Each one is assigned an ID based on its column and row, which we'll use later to read and assign contents to it. We'll store the representation of our data separately as a Spreadsheet object, and use that to render the contents of each input as needed.</p>
<p class="post-p">The Spreadsheet object has to be a bit clever, since it seeds to be able to hold both the input the user typed into a cell, as well as determine the value of an input (if it's an equation) and present that back to the interface. To that end, the UI can ask either <code class="code">getRawValue()</code> to retrieve what the user actually typed in, or <code class="code">getRenderedValue()</code> to process the equation represented by the raw value, if any.</p>
<p class="post-p">The full code of this solution is as follows:</p>
<p class="code-title">my-page.html</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel </span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./cells-table.css&#34;</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid w-full p-4 m-auto bg-blue-100 border-2 rounded-md&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;spreadsheet-wrapper&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;overflow-x-auto overflow-y-auto h-72&#34;</span>&gt;
        &lt;<span style="color:#f92672">table</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;spreadsheet&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;empty-cells:show&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;m-auto bg-white border-2&#34;</span>&gt;
            &lt;<span style="color:#f92672">thead</span>&gt;&lt;/<span style="color:#f92672">thead</span>&gt;
            &lt;<span style="color:#f92672">tbody</span>&gt;&lt;/<span style="color:#f92672">tbody</span>&gt;
        &lt;/<span style="color:#f92672">table</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
&lt;<span style="color:#f92672">py-env</span>&gt;
- paths:
    - ./spreadsheet.py
    - ./formula_parser.py
&lt;/<span style="color:#f92672">py-env</span>&gt;
&lt;<span style="color:#f92672">py-script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./cells-table.py&#34;</span>&gt;&lt;/<span style="color:#f92672">py-script</span>&gt;</code></pre></td></tr></table>
</div>
</div>
<br>
<p class="code-title">cells-table.py</p>
<div class="overflow-y-scroll h-124">
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> document, console
<span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> create_proxy
<span style="color:#f92672">from</span> spreadsheet <span style="color:#f92672">import</span> Spreadsheet
<span style="color:#f92672">import</span> re

columnIndices <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span>

document_sheet <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(<span style="color:#e6db74">&#34;spreadsheet&#34;</span>)

sheet <span style="color:#f92672">=</span> Spreadsheet()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_input_change</span>(e):
    console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;Processing Cell&#34;</span> <span style="color:#f92672">+</span> str(e<span style="color:#f92672">.</span>target<span style="color:#f92672">.</span>id))
    render_table(sheet)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_cell_enter</span>(e):
    code <span style="color:#f92672">=</span> e<span style="color:#f92672">.</span>keyCode
    <span style="color:#66d9ef">if</span> code <span style="color:#f92672">==</span> <span style="color:#ae81ff">13</span>:
        e<span style="color:#f92672">.</span>target<span style="color:#f92672">.</span>blur()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_cell_blur</span>(e):
    column <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;cell-(\w)-(\d+)&#39;</span>, e<span style="color:#f92672">.</span>target<span style="color:#f92672">.</span>id)<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)
    row <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;cell-(\w)-(\d+)&#39;</span>, e<span style="color:#f92672">.</span>target<span style="color:#f92672">.</span>id)<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>)
    sheet<span style="color:#f92672">.</span>set((column, row), e<span style="color:#f92672">.</span>target<span style="color:#f92672">.</span>value)
    _handle_input_change(e)

handle_cell_enter <span style="color:#f92672">=</span> create_proxy(_handle_cell_enter)
handle_input_blur <span style="color:#f92672">=</span> create_proxy(_handle_cell_blur)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_cell_focus</span>(e):
    console<span style="color:#f92672">.</span>log(str(e<span style="color:#f92672">.</span>target<span style="color:#f92672">.</span>id) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; gained focus&#34;</span>)
    _handle_input_change(e)

handle_cell_focus <span style="color:#f92672">=</span> create_proxy(_handle_cell_focus)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">render_table</span>(s: Spreadsheet):
    <span style="color:#66d9ef">for</span> location <span style="color:#f92672">in</span> s<span style="color:#f92672">.</span>data:
        id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cell-&#34;</span> <span style="color:#f92672">+</span> str(location[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">+</span> str(location[<span style="color:#ae81ff">1</span>])
        cell_input <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>getElementById(id)
        <span style="color:#66d9ef">if</span> cell_input <span style="color:#f92672">==</span> document<span style="color:#f92672">.</span>activeElement: 
            cell_input<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>getRawValue(location)
        <span style="color:#66d9ef">else</span>:
            cell_input<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>getRenderedValue(location)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_table</span>(num_x, num_y):
    create_header(num_x)
    create_cells(num_x, num_y)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_header</span>(num_x):
    header <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>querySelector(<span style="color:#e6db74">&#34;#spreadsheet &gt; thead&#34;</span>)
    upperLeft <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>createElement(<span style="color:#e6db74">&#34;th&#34;</span>)
    header<span style="color:#f92672">.</span>appendChild(upperLeft)
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(num_x):
        heading <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>createElement(<span style="color:#e6db74">&#34;th&#34;</span>)
        heading<span style="color:#f92672">.</span>innerText <span style="color:#f92672">=</span> columnIndices[i]
        header<span style="color:#f92672">.</span>appendChild(heading)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_cells</span>(num_x, num_y):
    <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(num_y):
        row <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>createElement(<span style="color:#e6db74">&#34;tr&#34;</span>)
        row<span style="color:#f92672">.</span>classList<span style="color:#f92672">.</span>add(<span style="color:#e6db74">&#34;row&#34;</span>, <span style="color:#e6db74">&#34;overflow&#34;</span>, <span style="color:#e6db74">&#34;overflow-x-hidden&#34;</span>)
        
        <span style="color:#75715e">#Create row label</span>
        cell <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>createElement(<span style="color:#e6db74">&#34;td&#34;</span>)
        label <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>createElement(<span style="color:#e6db74">&#34;div&#34;</span>)
        label<span style="color:#f92672">.</span>classList<span style="color:#f92672">.</span>add(<span style="color:#e6db74">&#34;w-full&#34;</span>, <span style="color:#e6db74">&#34;font-bold&#34;</span>, <span style="color:#e6db74">&#34;text-right&#34;</span>, <span style="color:#e6db74">&#34;px-2&#34;</span>)
        label<span style="color:#f92672">.</span>innerText <span style="color:#f92672">=</span> y
        cell<span style="color:#f92672">.</span>appendChild(label)
        row<span style="color:#f92672">.</span>appendChild(cell)

        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(num_x):
            sheet<span style="color:#f92672">.</span>set((columnIndices[x], y), <span style="color:#e6db74">&#34;=&#34;</span><span style="color:#f92672">+</span>str(x)<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;+&#34;</span><span style="color:#f92672">+</span>str(y))
            cell <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>createElement(<span style="color:#e6db74">&#34;td&#34;</span>)
            cell<span style="color:#f92672">.</span>classList<span style="color:#f92672">.</span>add(<span style="color:#e6db74">&#34;border-2&#34;</span>, <span style="color:#e6db74">&#34;border-gray-300&#34;</span>, <span style="color:#e6db74">&#34;w-48&#34;</span>, <span style="color:#e6db74">&#34;h-6&#34;</span>)
            new_input <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span>createElement(<span style="color:#e6db74">&#34;input&#34;</span>)
            new_input<span style="color:#f92672">.</span>classList<span style="color:#f92672">.</span>add(<span style="color:#e6db74">&#34;w-48&#34;</span>, <span style="color:#e6db74">&#34;h-6&#34;</span>)
            new_input<span style="color:#f92672">.</span>id<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;cell-</span><span style="color:#e6db74">{</span>columnIndices[x]<span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">{</span>y<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
            new_input<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;keydown&#34;</span>, handle_cell_enter)
            new_input<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;blur&#34;</span>, handle_input_blur)
            new_input<span style="color:#f92672">.</span>addEventListener(<span style="color:#e6db74">&#34;focus&#34;</span>, handle_cell_focus)
            cell<span style="color:#f92672">.</span>appendChild(new_input)
            row<span style="color:#f92672">.</span>appendChild(cell)
        document_sheet<span style="color:#f92672">.</span>appendChild(row)

create_table(len(columnIndices),<span style="color:#ae81ff">15</span>)
render_table(sheet)
    </code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>
<br>
<p class="code-title">spreadsheet.py</p>
<div class="overflow-y-scroll h-124">
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">from</span> formula_parser <span style="color:#f92672">import</span> FormulaParser, TokenType
<span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> console

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Spreadsheet</span>():
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>data : dict[tuple, str] <span style="color:#f92672">=</span> dict()

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set</span>(self, location: tuple, value: str):
        self<span style="color:#f92672">.</span>data[location] <span style="color:#f92672">=</span> value
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getRawValue</span>(self, location: tuple):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>data[location]

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getRenderedValue</span>(self, location: tuple):
        value <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>data[location] 
        <span style="color:#66d9ef">if</span> value <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>data[location][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;=&#34;</span>:
            tokens <span style="color:#f92672">=</span> FormulaParser<span style="color:#f92672">.</span>tokenize(value[<span style="color:#ae81ff">1</span>:])
            console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Tokens: </span><span style="color:#e6db74">{</span>tokens<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
            <span style="color:#66d9ef">if</span> any([t<span style="color:#f92672">.</span>token_type <span style="color:#f92672">==</span> TokenType<span style="color:#f92672">.</span>T_CELL <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tokens]):
                <span style="color:#66d9ef">return</span> FormulaParser<span style="color:#f92672">.</span>solve_with_references(tokens, self<span style="color:#f92672">.</span>data)
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">return</span> FormulaParser<span style="color:#f92672">.</span>solve_full_expression(tokens)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> value
    </code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>
<br>
<p class="code-title">formula_parser.py</p>
<div class="overflow-y-scroll h-124">
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">from</span> copy <span style="color:#f92672">import</span> deepcopy
<span style="color:#f92672">from</span> enum <span style="color:#f92672">import</span> Enum, auto
<span style="color:#f92672">import</span> re
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Iterable

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TokenType</span>(Enum):
    T_NUM <span style="color:#f92672">=</span> auto()
    T_EMPTY <span style="color:#f92672">=</span> auto()
    T_PLUS <span style="color:#f92672">=</span> auto()
    T_MINUS <span style="color:#f92672">=</span> auto()
    T_DIVIDE <span style="color:#f92672">=</span> auto()
    T_MULT <span style="color:#f92672">=</span> auto()
    T_LEFTP <span style="color:#f92672">=</span> auto()
    T_RIGHTP <span style="color:#f92672">=</span> auto()
    T_CELL <span style="color:#f92672">=</span> auto()
    T_END <span style="color:#f92672">=</span> auto()
    T_EXPRESSION <span style="color:#f92672">=</span> auto()

arithmetic <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;+&#34;</span> : TokenType<span style="color:#f92672">.</span>T_PLUS,
    <span style="color:#e6db74">&#34;-&#34;</span> : TokenType<span style="color:#f92672">.</span>T_MINUS,
    <span style="color:#e6db74">&#34;/&#34;</span> : TokenType<span style="color:#f92672">.</span>T_DIVIDE,
    <span style="color:#e6db74">&#34;*&#34;</span> : TokenType<span style="color:#f92672">.</span>T_MULT,
    <span style="color:#e6db74">&#34;(&#34;</span> : TokenType<span style="color:#f92672">.</span>T_LEFTP,
    <span style="color:#e6db74">&#34;)&#34;</span> : TokenType<span style="color:#f92672">.</span>T_RIGHTP,
}

parens_types <span style="color:#f92672">=</span> {TokenType<span style="color:#f92672">.</span>T_LEFTP, TokenType<span style="color:#f92672">.</span>T_RIGHTP}
my_dear <span style="color:#f92672">=</span> {TokenType<span style="color:#f92672">.</span>T_MULT : <span style="color:#66d9ef">lambda</span> x,y: x<span style="color:#f92672">*</span>y, TokenType<span style="color:#f92672">.</span>T_DIVIDE: <span style="color:#66d9ef">lambda</span> x, y: x<span style="color:#f92672">/</span>y}
aunt_sally <span style="color:#f92672">=</span> {TokenType<span style="color:#f92672">.</span>T_PLUS: <span style="color:#66d9ef">lambda</span> x,y: x<span style="color:#f92672">+</span>y, TokenType<span style="color:#f92672">.</span>T_MINUS: <span style="color:#66d9ef">lambda</span> x, y: x <span style="color:#f92672">-</span> y}

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">quiet_index</span>(i: Iterable, obj):
    <span style="color:#66d9ef">try</span>:
        index <span style="color:#f92672">=</span> i<span style="color:#f92672">.</span>index(obj)
    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span> <span style="color:#66d9ef">as</span> err:
        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>

    <span style="color:#66d9ef">return</span> index

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ParseError</span>(<span style="color:#a6e22e">Exception</span>):
    <span style="color:#66d9ef">pass</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Node</span>:
    <span style="color:#66d9ef">def</span> __init__(self, token_type, value<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, children<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
        self<span style="color:#f92672">.</span>token_type <span style="color:#f92672">=</span> token_type
        self<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> value
        <span style="color:#66d9ef">if</span> children <span style="color:#f92672">==</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>children <span style="color:#f92672">=</span> list()
        <span style="color:#66d9ef">else</span>: self<span style="color:#f92672">.</span>children <span style="color:#f92672">=</span> children
    
    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Node (</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>token_type<span style="color:#e6db74">}</span><span style="color:#e6db74">):&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>value<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span> <span style="color:#f92672">+</span> (<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; children: </span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>children<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>children <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;&#34;</span>)

    <span style="color:#66d9ef">def</span> __repr__(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__str__()

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_value</span>(self):
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>token_type <span style="color:#f92672">==</span> TokenType<span style="color:#f92672">.</span>T_NUM:
            <span style="color:#66d9ef">return</span> float(self<span style="color:#f92672">.</span>value)
        <span style="color:#66d9ef">else</span>: <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Could not derive value of token </span><span style="color:#e6db74">{</span>self<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FormulaParser</span>():
    <span style="color:#75715e">#re_ident = r&#34;[a-zA-Z_]\w*&#34; #matches identifiers</span>
    re_decimal <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;-?\d+(\.\d*)?&#34;</span> <span style="color:#75715e">#matches decimal numbers</span>
    re_cell <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;([a-zA-Z])(\d+)&#34;</span> <span style="color:#75715e">#group 1 is column, group 2 is row</span>
    <span style="color:#75715e">#re_range = re_cell + &#34;:&#34; + re_cell #matches a range like A2:B4</span>
    re_operators <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;[\+\-\/\*\(\)]&#39;</span>

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tokenize</span>(value: str):
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> value <span style="color:#f92672">or</span> len(value) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">return</span>
        value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(value<span style="color:#f92672">.</span>split()) <span style="color:#75715e">#remove all whitespace</span>

        tokens <span style="color:#f92672">=</span> list()
        <span style="color:#66d9ef">while</span> len(value) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
            token <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
            match <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
            <span style="color:#66d9ef">if</span> match <span style="color:#f92672">:=</span> re<span style="color:#f92672">.</span>match(FormulaParser<span style="color:#f92672">.</span>re_cell, value):
                token <span style="color:#f92672">=</span> Node(TokenType<span style="color:#f92672">.</span>T_CELL, value<span style="color:#f92672">=</span>match<span style="color:#f92672">.</span>group())
            <span style="color:#66d9ef">elif</span> match <span style="color:#f92672">:=</span> re<span style="color:#f92672">.</span>match(FormulaParser<span style="color:#f92672">.</span>re_operators, value):
                token <span style="color:#f92672">=</span> Node(token_type<span style="color:#f92672">=</span>arithmetic[match<span style="color:#f92672">.</span>group()], value <span style="color:#f92672">=</span> match<span style="color:#f92672">.</span>group())
            <span style="color:#66d9ef">elif</span> match <span style="color:#f92672">:=</span> re<span style="color:#f92672">.</span>match(FormulaParser<span style="color:#f92672">.</span>re_decimal, value):
                token <span style="color:#f92672">=</span> Node(TokenType<span style="color:#f92672">.</span>T_NUM, value<span style="color:#f92672">=</span>float(match<span style="color:#f92672">.</span>group()))
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;No further tokens found in </span><span style="color:#e6db74">{</span>value<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
            tokens<span style="color:#f92672">.</span>append(token)
            value <span style="color:#f92672">=</span> value[match<span style="color:#f92672">.</span>end():]
            
        tokens <span style="color:#f92672">=</span> [Node(token_type<span style="color:#f92672">=</span>TokenType<span style="color:#f92672">.</span>T_LEFTP, value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;start&#34;</span>)] <span style="color:#f92672">+</span> tokens <span style="color:#f92672">+</span> [Node(token_type<span style="color:#f92672">=</span>TokenType<span style="color:#f92672">.</span>T_RIGHTP, value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;end&#34;</span>)]
        <span style="color:#66d9ef">return</span> tokens

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_referenced_cells</span>(token_list: list) <span style="color:#f92672">-&gt;</span> list:
        <span style="color:#66d9ef">return</span> [node <span style="color:#66d9ef">for</span> node <span style="color:#f92672">in</span> token_list <span style="color:#66d9ef">if</span> isinstance(node, Node) <span style="color:#f92672">and</span> node<span style="color:#f92672">.</span>token_type <span style="color:#f92672">==</span> TokenType<span style="color:#f92672">.</span>T_CELL]

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find_closest_parens</span>(token_list:list) <span style="color:#f92672">-&gt;</span> tuple:
        leftIndex <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
        rightIndex <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
        <span style="color:#66d9ef">for</span> i, token <span style="color:#f92672">in</span> enumerate(token_list):
            <span style="color:#66d9ef">if</span> token<span style="color:#f92672">.</span>token_type <span style="color:#f92672">==</span> TokenType<span style="color:#f92672">.</span>T_LEFTP:
                leftIndex <span style="color:#f92672">=</span> i
            <span style="color:#66d9ef">elif</span> token<span style="color:#f92672">.</span>token_type <span style="color:#f92672">==</span> TokenType<span style="color:#f92672">.</span>T_RIGHTP:
                <span style="color:#66d9ef">if</span> leftIndex <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>:
                    <span style="color:#66d9ef">return</span> leftIndex, i
                    <span style="color:#66d9ef">break</span>
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span> (<span style="color:#e6db74">&#34;Left and right parentheses do not match&#34;</span>)
        
        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>

    <span style="color:#75715e">#-----------------------------------------#</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve_full_expression</span>(token_list:list) <span style="color:#f92672">-&gt;</span> float:
        original_list <span style="color:#f92672">=</span> deepcopy(token_list)
        <span style="color:#66d9ef">while</span> any([t<span style="color:#f92672">.</span>token_type <span style="color:#f92672">in</span> parens_types <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> token_list]):
            left_p, right_p <span style="color:#f92672">=</span> FormulaParser<span style="color:#f92672">.</span>find_closest_parens(token_list)
            result <span style="color:#f92672">=</span> FormulaParser<span style="color:#f92672">.</span>evaluate_simple_expression(token_list[left_p<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:right_p])
            token_list <span style="color:#f92672">=</span> (token_list[:left_p] <span style="color:#66d9ef">if</span> left_p <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> []) <span style="color:#f92672">+</span> [result] <span style="color:#f92672">+</span> (token_list[right_p <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>:] <span style="color:#66d9ef">if</span> (right_p <span style="color:#f92672">&lt;</span> len(token_list) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">else</span> [])
            

        <span style="color:#66d9ef">if</span> len(token_list) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
            <span style="color:#66d9ef">return</span> token_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>value
        
        <span style="color:#66d9ef">raise</span> ParseError(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Failed to parse full expression </span><span style="color:#e6db74">{</span>original_list<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Final tokens were </span><span style="color:#e6db74">{</span>token_list<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)


    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate_simple_expression</span>(token_list:list) <span style="color:#f92672">-&gt;</span> Node:
        original_list <span style="color:#f92672">=</span> deepcopy(token_list)
        <span style="color:#66d9ef">if</span> len(token_list) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
            <span style="color:#66d9ef">return</span> token_list[<span style="color:#ae81ff">0</span>]

        token_list <span style="color:#f92672">=</span> FormulaParser<span style="color:#f92672">.</span>evaluate_for_single_opset(token_list, my_dear)
        token_list <span style="color:#f92672">=</span> FormulaParser<span style="color:#f92672">.</span>evaluate_for_single_opset(token_list, aunt_sally)
        
        <span style="color:#66d9ef">if</span> len(token_list) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
            <span style="color:#66d9ef">return</span> token_list[<span style="color:#ae81ff">0</span>]
        <span style="color:#66d9ef">else</span>: <span style="color:#66d9ef">raise</span> ParseError(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Failed to parse simple expression </span><span style="color:#e6db74">{</span>original_list<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Final tokens were </span><span style="color:#e6db74">{</span>token_list<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate_for_single_opset</span>(token_list:list, operators:dict) <span style="color:#f92672">-&gt;</span> list:
        <span style="color:#66d9ef">while</span> any(ops_to_do <span style="color:#f92672">:=</span> [t<span style="color:#f92672">.</span>token_type <span style="color:#f92672">in</span> operators <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> token_list]):
            op_location <span style="color:#f92672">=</span> ops_to_do<span style="color:#f92672">.</span>index(<span style="color:#66d9ef">True</span>)
            func <span style="color:#f92672">=</span> operators[token_list[op_location]<span style="color:#f92672">.</span>token_type]

            result <span style="color:#f92672">=</span> func(token_list[op_location<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>value, token_list[op_location<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>value)
            new_node <span style="color:#f92672">=</span> Node(TokenType<span style="color:#f92672">.</span>T_NUM, value <span style="color:#f92672">=</span> result)

            token_list <span style="color:#f92672">=</span> (token_list[:op_location<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">if</span> op_location <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> []) <span style="color:#f92672">+</span> [new_node] <span style="color:#f92672">+</span> (token_list[op_location <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>:] <span style="color:#66d9ef">if</span> op_location <span style="color:#f92672">&lt;</span> len(token_list) <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">else</span> [])
        <span style="color:#66d9ef">return</span> token_list

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tokenize_and_solve</span>(expression:str) <span style="color:#f92672">-&gt;</span> float:
        <span style="color:#66d9ef">return</span> FormulaParser<span style="color:#f92672">.</span>solve_full_expression(FormulaParser<span style="color:#f92672">.</span>tokenize(expression))

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve_with_references</span>(token_list:list, data: dict, already_referenced:set <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> float:
        <span style="color:#75715e">#Not yet implemented</span>
        <span style="color:#66d9ef">return</span> FormulaParser<span style="color:#f92672">.</span>solve_full_expression(token_list)

        <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">        Psuedocode:
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        Get list of all references in tokens
</span><span style="color:#e6db74">            if any of these area in our already-referenced set, we have a loop and cannot solve this. Bail!
</span><span style="color:#e6db74">        Recursively get the values of each of those cells.
</span><span style="color:#e6db74">            If the cell is a striaght numerical value, just get a node with that value
</span><span style="color:#e6db74">            If the cell is not a number or tokenizable, BAIL! #REF error
</span><span style="color:#e6db74">            Tokenize their destination
</span><span style="color:#e6db74">            If they have references, call this again with self added to the list of referenced cells
</span><span style="color:#e6db74">            If not, solve them normally with solve_full_expression
</span><span style="color:#e6db74">        solve_full_expression of this normal expression
</span><span style="color:#e6db74">        Return
</span><span style="color:#e6db74">        &#39;&#39;&#39;</span>



<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    values <span style="color:#f92672">=</span> [
        <span style="color:#e6db74">&#34;2 + 3&#34;</span>,
        <span style="color:#e6db74">&#34;2 * 3&#34;</span>,
        <span style="color:#e6db74">&#34;2 + 3 * 4&#34;</span>,
        <span style="color:#e6db74">&#34;2 * 3 + 4&#34;</span>,
        <span style="color:#e6db74">&#34;2 * (3 + 4)&#34;</span>,
        <span style="color:#e6db74">&#34;(2 * 3) + 4&#34;</span>,
        <span style="color:#e6db74">&#34;(2 + 3) * (4 + 5)&#34;</span>
    ]
    <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> values:
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>v<span style="color:#e6db74">}</span><span style="color:#e6db74"> = </span><span style="color:#e6db74">{</span>FormulaParser<span style="color:#f92672">.</span>tokenize_and_solve(v)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)

    </code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>
<hr>
<p class="post-p">If you've made it this far down the page, I'm truly honored. <a href="https://twitter.com/jeffersglass">I'm just a guy who loves Python and playing with code</a>, and I'd love to hear what you think of PyScript.</p>
<py-script src="timer.py"></py-script>
				</div>
				
			</article>
			<footer>
    <div class = "pt-4 pb-6 text-center text-gray-500" id="Footer">
        <p class="">All contents © Jeff Glass 2022. All rights reserved.</p>
        <p>See <a href="../../cloud-resume-challenge" class="underline">how this site was built</a>.</p>
    </div>
</footer>
		</div>
	</main>


	
</body>
</html>
