<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Monkeypatching Rich for Beautiful Terminals in Pyscript</title>
	<meta name="description" content="Electronics, Making, Software Development, and Amateur Radio from a Midwest Nerd">
	
	
	
	
	<link rel ="stylesheet" type="text/css" href="../../css/style.css">
	
	<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jeff.glass/post/pyscript-rich/rich-features.png"/>
<meta name="twitter:title" content="Monkeypatching Rich for Beautiful Terminals in Pyscript"/>
<meta name="twitter:description" content="Patching the Rich formattier to output to Pyscript"/>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/css/lightbox.min.css" />	
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />

	
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BZTF8S6M1E"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BZTF8S6M1E', { 'anonymize_ip': false });
}
</script>


	<link rel="icon" href="../../favicon.ico?v=2"> 
	
</head>
<body>
	
	<main>
		<header>

<div class="fixed z-20 flex flex-row items-end w-full p-2 bg-green-800 t-0">
    
    <div class="flex-none hidden lg:flex">
        <div class="flex-none px-2">
            <span class="px-4 text-3xl font-bold text-green-200 transition duration-500 transform hover:text-green-50">
                <a href='../../' class= "no-style-link">Jeff Glass</a>
            </span>
        </div>
        <div class="flex-none menu-item-green ">
            <a href="../../#Introduction" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Home
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../project" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Projects
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../post" class="z-30 clickable-link-box no-style-link"><span></span></a> Blog  
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../oneoff" class="z-30 clickable-link-box no-style-link"><span></span></a>
            One-Offs
        </div>
    </div>
    
    <div class="flex justify-start flex-1 w-auto lg:hidden align-left large-menu">
        <div class="flex-none menu-item-green mobile-menu-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </div>
        <div class="flex-none">
            <span class="px-4 text-3xl font-bold text-green-200 transition duration-500 transform hover:text-green-50">
                <a href='../../' class= "no-style-link">Jeff Glass</a>
            </span>
        </div>
    </div>
    
    
    <div class="hidden text-green-200 transition mobile-menu">
            <div class="w-auto m-auto"><a href="../../"         class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Home</a></div>
            <div class="w-auto m-auto"><a href="../../project"  class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Projects</a></div>
            <div class="w-auto m-auto"><a href="../../post"     class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Blog</a></div>
            <div class="w-auto m-auto"><a href="../../oneoff"   class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">One-Offs</a></div>
    </div>
    
    <div class="justify-end flex-1 hidden w-auto h-auto align-top md:flex social-buttons">
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.youtube.com/channel/UCjgmTMVx2B5_DOB3bCZBq7A" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg class = "z-0" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M5 7H19C19.5523 7 20 7.44771 20 8V16C20 16.5523 19.5523 17 19 17H5C4.44772 17 4 16.5523 4 16V8C4 7.44772 4.44772 7 5 7ZM2 8C2 6.34315 3.34315 5 5 5H19C20.6569 5 22 6.34315 22 8V16C22 17.6569 20.6569 19 19 19H5C3.34315 19 2 17.6569 2 16V8ZM10 9L14 12L10 15V9Z" fill="currentColor"/>
            </svg>
        </div>
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.twitter.com/jeffersglass" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" class="ionicon" viewBox="0 0 512 512"><path d="M496 109.5a201.8 201.8 0 01-56.55 15.3 97.51 97.51 0 0043.33-53.6 197.74 197.74 0 01-62.56 23.5A99.14 99.14 0 00348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 002.54 22.1 280.7 280.7 0 01-203-101.3A95.69 95.69 0 0036 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0135.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 01-25.94 3.4 94.38 94.38 0 01-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0139.5 405.6a203 203 0 01-23.5-1.4A278.68 278.68 0 00166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 00496 109.5z" fill="currentColor"/></svg>
        </div>
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.linkedin.com/in/jeffrey-r-glass" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 512 512"><path d="M444.17,32H70.28C49.85,32,32,46.7,32,66.89V441.61C32,461.91,49.85,480,70.28,480H444.06C464.6,480,480,461.79,480,441.61V66.89C480.12,46.7,464.6,32,444.17,32ZM170.87,405.43H106.69V205.88h64.18ZM141,175.54h-.46c-20.54,0-33.84-15.29-33.84-34.43,0-19.49,13.65-34.42,34.65-34.42s33.85,14.82,34.31,34.42C175.65,160.25,162.35,175.54,141,175.54ZM405.43,405.43H341.25V296.32c0-26.14-9.34-44-32.56-44-17.74,0-28.24,12-32.91,23.69-1.75,4.2-2.22,9.92-2.22,15.76V405.43H209.38V205.88h64.18v27.77c9.34-13.3,23.93-32.44,57.88-32.44,42.13,0,74,27.77,74,87.64Z" fill="currentColor"/></svg>
        </div>
    </div>
</div>
</header>
<script>
    const btn = document.querySelector("div.mobile-menu-button")
    const mobileMenu = document.querySelector(".mobile-menu")
    const largeMenu = document.querySelector(".large-menu")
    const socialButtons = document.querySelector(".social-buttons")

    btn.addEventListener("click", () =>{
        openMenu();
    })

    function openMenu() {
        mobileMenu.classList.toggle("hidden");
        largeMenu.classList.toggle("hidden");
        socialButtons.classList.add("hidden");
    }

    
    const smSize = 640;
    const mdSize = 768;
    const largeSize = 1024;
    window.addEventListener('resize', function(event) {
        if (event.target.screen.width > smSize ){
            mobileMenu.classList.add("hidden");
            largeMenu.classList.remove("hidden");
        }
    }, true);
</script>

		<div class="w-full bg-green-800 bg-opacity-10">
			<div class="pt-16"></div>
			<article class="w-full px-16 pt-4 pb-4 m-auto lg:w-11/12 bg-gray-50">
				<h1 class="pb-2 text-4xl">Monkeypatching Rich for Beautiful Terminals in Pyscript</h1>
				<p>Published September 27, 2022</p>
				
				<div>
					<span>Tags:</span>
					
					<a href="../../tags/pyscript">pyscript</a>
					
					<a href="../../tags/python">python</a>
					
					<a href="../../tags/rich">rich</a>
					
				</div>
				
				
				<hr>
				<div>
					<py-env>
    - rich
    - Faker
    - paths:
        - _richsetup.py
        - scripts/working/livetable.py
</py-env>
<script src="https://pyscript.net/releases/2022.06.1/pyscript.js" defer></script>
<link rel="stylesheet" href="https://pyscript.net/releases/2022.06.1/pyscript.css" />
<py-script src="./_richsetup.py"></py-script>
<div class="p-4 mt-4 bg-gray-100 border-2">
    <div class="grid items-center grid-cols-1 gap-y-2 xl:grid-cols-2">
        <div><py-script src="./scripts/working/intro.py"></py-script></div>
        <div><div>
    <p class="code-title">intro.py</p>
    
    
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">print(<span style="color:#e6db74">&#34;[bold]This text[/bold] is being [b]formatted[/b] by the [link https://github.com/Textualize/rich]Rich Console Formatting Library[/]&#34;</span>)
print(<span style="color:#e6db74">&#34;and output with [yellow1 on grey15]&lt;PyScript&gt;[/]. There&#39;s a [b link ../../project/richdemo]whole page of examples :link:[/]&#34;</span>)
print(<span style="color:#e6db74">&#34;The REPL below is automatically formatted with RICH;&#34;</span>)
print(<span style="color:#e6db74">&#34;Press [italic]shift+enter[/] or click :play_button: to execute the REPL:&#34;</span>)</code></pre></td></tr></table>
</div>
</div>
    
</div></div>
    </div>
    <p class="post-p"></py-script><py-repl id="top" root="top" auto-generate="true">from rich import inspect; inspect(int)</py-repl></p>
</div>
<hr>
<h2 class="post-h2">TL;DR: How to Use Rich in PyScript</h2>
<p class="post-p">To use Rich for the output of all your PyScript tags, add the following to a new PyScript take at the top of the page's <code>body</code>:</p>
<div>
    <p class="code-title">_richsetup.py</p>
    
    
    <div class="overflow-y-scroll h-52">
    
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Iterable
<span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> stdout, modules
<span style="color:#f92672">from</span> contextlib <span style="color:#f92672">import</span> contextmanager

<span style="color:#f92672">from</span> rich <span style="color:#f92672">import</span> get_console
<span style="color:#f92672">from</span> rich.console <span style="color:#f92672">import</span> _is_jupyter
<span style="color:#f92672">from</span> rich.segment <span style="color:#f92672">import</span> Segment
<span style="color:#f92672">import</span> rich.jupyter

<span style="color:#f92672">from</span> pyodide <span style="color:#f92672">import</span> JsException
<span style="color:#f92672">from</span> js <span style="color:#f92672">import</span> console

<span style="color:#75715e"># Per pyodide docs, determine if we&#39;re running inside pyodide at Runtime</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_pyodide</span>() <span style="color:#f92672">-&gt;</span> bool:
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;pyodide&#34;</span> <span style="color:#f92672">in</span> modules
 
<span style="color:#75715e"># Patch jupyter detection of the global _console object to detect pyodide</span>
c <span style="color:#f92672">=</span> get_console()
c<span style="color:#f92672">.</span>is_jupyter <span style="color:#f92672">=</span> is_pyodide <span style="color:#75715e">#monkeypatch jupyter detection @propety</span>

<span style="color:#75715e"># patch function so if user creates any additional Consoles they behave correctly</span>
<span style="color:#75715e"># While the global _console us</span>
_is_jupyter <span style="color:#f92672">=</span> is_pyodide

<span style="color:#75715e"># Jupyter display method renders html and writes to stdout</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">display_pyscript</span>(segments: Iterable[Segment], text: str) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;Allow output of raw HTML within pyscript/pyodide&#34;&#34;&#34;</span>
    html <span style="color:#f92672">=</span> rich<span style="color:#f92672">.</span>jupyter<span style="color:#f92672">.</span>_render_segments(segments)
    stdout<span style="color:#f92672">.</span>write(html)

<span style="color:#75715e">#patch jupyter display method to write processed HTML to stdout</span>
rich<span style="color:#f92672">.</span>jupyter<span style="color:#f92672">.</span>display <span style="color:#f92672">=</span> display_pyscript 

print <span style="color:#f92672">=</span> get_console()<span style="color:#f92672">.</span>print

<span style="color:#75715e"># PyScripts OutputCTXManager is used for stdout but does not implement</span>
<span style="color:#75715e"># full fill interface; this prevents a warning each time console tries</span>
<span style="color:#75715e"># to print</span>
stdout<span style="color:#f92672">.</span>flush <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span>: <span style="color:#66d9ef">None</span>

<span style="color:#75715e">##---- Redefine Pyscript.write()---</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">output_buffer</span>():
    <span style="color:#e6db74">&#34;&#34;&#34; A (inefficient) buffer to capture stdout to a string &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>_internal_buffer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">write</span>(self, value: any):
        <span style="color:#66d9ef">if</span> len(self<span style="color:#f92672">.</span>_internal_buffer):
            self<span style="color:#f92672">.</span>internal_buffer <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;&lt;br&gt;&#39;</span>
        self<span style="color:#f92672">.</span>_internal_buffer <span style="color:#f92672">+=</span> value

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_internal_buffer

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">flush</span>(self):
        <span style="color:#66d9ef">pass</span>

<span style="color:#a6e22e">@contextmanager</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stdout_to_buffer</span>(el:Element, append: bool) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
    <span style="color:#e6db74">&#34;&#34;&#34; A context manager to manage an output_buffer, writes to an Element on closure&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">global</span> stdout <span style="color:#75715e">#Usually Pyscript OutputCTXManager at this pont</span>
    _old_stdout <span style="color:#f92672">=</span> stdout
    stdout <span style="color:#f92672">=</span> output_buffer()
    <span style="color:#66d9ef">try</span>:
        <span style="color:#66d9ef">yield</span>
    <span style="color:#66d9ef">finally</span>:
        el<span style="color:#f92672">.</span>_write(stdout<span style="color:#f92672">.</span>read(), append)
        stdout <span style="color:#f92672">=</span> _old_stdout 

Element<span style="color:#f92672">.</span>_write <span style="color:#f92672">=</span> Element<span style="color:#f92672">.</span>write

<span style="color:#75715e">#Allow Element.write() to take an object from rich</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">newWrite</span>(self, value, append: bool <span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
    <span style="color:#e6db74">&#34;&#34;&#34; A Monkeypatched version of Pyscript&#39;s Element.write(), auto-transforming Rich objects and rendering standard objects. &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">if</span> isinstance(value, (str, <span style="color:#a6e22e">Exception</span>, JsException)):
        self<span style="color:#f92672">.</span>_write(value, append)
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">with</span> stdout_to_buffer(self, append):
            get_console()<span style="color:#f92672">.</span>print(value)

Element<span style="color:#f92672">.</span>write <span style="color:#f92672">=</span> newWrite</code></pre></td></tr></table>
</div>
</div>
    
    </div>
    <p class="post-img-caption">Scroll to see complete code</p>
    
</div>
<p class="post-p">Live updates work a little differently in PyScript than they do in the terminal - see the <a href="#live-updates">Live Updates</a> section for details.</p>
<blockquote class="p-2 mx-6 mb-4 italic bg-yellow-200 border-l-4 border-gray-800">This code was written (and is running on this page on) <span class="font-semibold">PyScript Version 2022.06.1</span>. Since there's an <a href="https://github.com/pyscript/pyscript/issues/622"> overhaul of how PyScript renders</a> coming very soon, check the documentation for updates.</blockquote>
<h2 class="post-h2">Background</h2>
<div class="flex flex-col lg:flex-row">
    <div class="w-full lg:w-3/5">
        <p class="post-p">Though PyScript is still in its infancy, the possibilities unlocked by running Python in a browser are already blossoming. As such, I'm seeing more and more users on the <a href="https://community.anaconda.cloud/c/tech-topics/pyscript/41">official forums</a>, the <a href="https://discord.com/invite/TynfPGRwda">unofficial Discord</a>, and the <a href="https://github.com/pyscript/pyscript">Github Issue Tracker</a> interested in working with their favorite libraries to the web. Let's look at the process of taking a package that <span class="italic">runs</span> but doesn't run <span class="italic">well</span>, and see how we can use patch it after import to bring it to life using Pyscript.</p>
        <p class="post-p">Lots of packages work fine right out of the box - anything <a href="https://pyodide.org/en/stable/usage/loading-packages.html#loading-packages">written in Pure Python stands a good chance of at least running</a>. But just because it runs, doesn't mean it'll look good or behave the way we expect objects to on a webpage. Interactive packages, like <a href="https://matplotlib.org/">matplotlib</a> or terminal-based packages like <a href="https://github.com/tqdm/tqdm">tqdm</a> or <a href="https://github.com/tartley/colorama">colorama</a>, may not be immediately interactable in the browser, because they've implemented their own methods for interpretting input/output that the browser doesn't play nicely with. Just because the PyScript/Pyodide interpretter doesn't crash doesn't mean you can get useful info in and out of an existing module.</p>
        <p class="post-p">One such library is <a href="https://github.com/Textualize/rich">Rich</a>: "a Python library for rich text and beautiful formatting in the terminal" by Will McGugan. It allows for tasteful pretty-printing of most Python objects, syntax highlighting, color and layout control and more, all written in Pure Python. See the sample image to the side or the linked homepage for bountiful exmaples.</p>
        <p class="post-p">Of course, Rich is intended to run in the terminal. Since the display functionality in a web browser differs significantly from a terminal environment, there's no reason to expect it will work out of the box in PyScript. But since it exists as a pure Python wheel and is importable by Pyodide, I wanted to see what it would take to get it working.</p>
        <p class="post-p">What follows is the result of a few hours of bashing things together. It's not meant to be production ready (thought it could turn into a module if there's interest). Rather, it's meant to demonstrate a patching strategy for modules that already integrate with web-Python environments like Jupyter and iPython.</p>
        <p class="post-p">If you want to skip the dev log, you can skip to <a href="patch">the code that runs to patch Rich on this page </a> or the <a href="#examples">gallery of Rich-in-PyScript samples</a> below.</p>
    </div>
    <div class="items-center justify-center w-auto mx-4 md:float-right md:w-96">
        <img src="rich-features.png" alt="A demo of the features of the rich library, including colors, styles, text, markup etc" class="mx-auto w-96">
        <p class="italic">The demo image from the Rich GitHub page shows off its many features</p>
    </div>
</div>
<h2 class="post-h2">The Groundwork</h2>
<p class="post-p">The strategy we'll employ to get Rich working is called "Monkeypatching." <a href="https://web.archive.org/web/20120730014107/http://wiki.zope.org/zope2/MonkeyPatch">From the Zope Wiki</a>:</p>
<p class="p-2 mx-6 mb-4 italic bg-gray-100 border-l-4 border-gray-800">A MonkeyPatch is a piece of Python code which extends or modifies other code at runtime (typically at startup)...The motivation for monkeypatching is typically that the developer needs to modify or extend behavior of a third-party product ... and does not wish to maintain a private copy of the source code.</p>
<p class="post-p">So, we'll be loading/importing Rich <span class="italic">as-is</span>, modifying some of the attributes/methods/behaviors of its classes and functions and leaving others along. This will let us preserve the most of Rich's functionality untouched, while tweaking it just enough to work inside PyScript.</p>
<p class="post-p">Almost all of the heavy lifting in terms of the formatting is handled by the fact Rich <a href="https://www.willmcgugan.com/blog/tech/post/rich-adds-support-for-jupyter-notebooks/">already supports Jupyter Notebooks</a>, so there's already translation in place to translate Rich's internal formatting syntax to HTML. All we have to do is:</p>
<ul class="post-ul">
    <li>Import rich (which means it'll need to be present in our <code class="code">&lt;py-env&gt;</code>  </li>
    <li>Hook into or replace the code that detects that we're running in a Notebook to instead tell that we're running inside Pyodide.</li>
    <li>Take the output that would be fed to the notebook and feed it to <code class="code">stdout</code>, where PyScript's context managers will get it to the right place</li>
    <li>Overwrite the built-in <code class="code">print()</code> function to point to rich's print function, to get nicely formatted printing</li>
    <li>Point PyScript's <code class="code">Element.write()</code> method at a new method that hooks into Rich's __rich_console__ and <code class="code">__rich__</code> formatting methods.</li>
</ul>
<h2 class="post-h2">The Steps</h2>
<h4 class="post-h4">Making Rich Think We're in a Jupyter Notebook</h3>
<p class="post-p">Since we're intending to run this in a browser anyway, we could just set <code class="code">console.is_jupyter = True</code> to force Rich to render HTML. But we'll be slightly nicer and redirect that property to a new function <code class="code">is_pyodide</code>. This just looks to see if 'pyodide' is in our available modules, <a href="https://pyodide.org/en/stable/usage/faq.html#how-to-detect-that-code-is-run-with-pyodide">as suggested by the pyodide FAQ</a>. This means that whenever our code is running in Pyodide, the Rich library will render as if it's going to be output to a Jupyter notebook.</p>
<div class="mb-6 lg:mx-4">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Per pyodide docs, determine if we&#39;re running inside pyodide at Runtime</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_pyodide</span>() <span style="color:#f92672">-&gt;</span> bool:
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;pyodide&#34;</span> <span style="color:#f92672">in</span> modules
 
<span style="color:#75715e"># Patch jupyter detection of the global _console object to detect pyodide</span>
c <span style="color:#f92672">=</span> get_console()
c<span style="color:#f92672">.</span>is_jupyter <span style="color:#f92672">=</span> is_pyodide <span style="color:#75715e">#monkeypatch jupyter detection @propety</span>

<span style="color:#75715e"># patch function so if user creates any additional Consoles they behave correctly</span>
<span style="color:#75715e"># While the global _console us</span>
_is_jupyter <span style="color:#f92672">=</span> is_pyodide</code></pre></td></tr></table>
</div>
</div>
</div>
<h4 class="post-h4">Replacing Rich's Display Function with our Own</h4>
<p class="post-p">Similarly, we'll point <code class="code">rich.jupyter.display</code> at a new function we'll write that gets the output that the Jupyter notebook would have received and send it to stdout. And, as noted above, we'll redirect the usual <code class="code">print</code> function to the rich print function, to get nicely formatted outputs whenever we use the standard print() syntax.</p>
<div class="mb-6 lg:mx-4">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Jupyter display method renders html and writes to stdout</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">display_pyscript</span>(segments: Iterable[Segment], text: str) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;Allow output of raw HTML within pyscript/pyodide&#34;&#34;&#34;</span>
    html <span style="color:#f92672">=</span> rich<span style="color:#f92672">.</span>jupyter<span style="color:#f92672">.</span>_render_segments(segments)
    stdout<span style="color:#f92672">.</span>write(html)

<span style="color:#75715e">#patch jupyter display method to write processed HTML to stdout</span>
rich<span style="color:#f92672">.</span>jupyter<span style="color:#f92672">.</span>display <span style="color:#f92672">=</span> display_pyscript 

print <span style="color:#f92672">=</span> get_console()<span style="color:#f92672">.</span>print</code></pre></td></tr></table>
</div>
</div>
</div>
<h4 class="post-h4">Fixing <span class="italic">Element.write()</span></h4>
<p class="post-p">Finally, we need to match some adjustments to PyScript's <code class="code">Element.write()</code> function, which is a utility method that allows PyScript users to send output to a specific DOM element directly. Since this bypasses the usual writing to stdout (and directly modifies the <span class="italic">innerHTML</span> attribute of the DOM element), we need to do a little legwork to get the formatting to work.</p>
<p class="post-p">In a nutshell, we'll solve this issue in 3 steps:
    <ul class="post-ul">
        <li>When the user's code calls to <code class="code">Element.write()</code>, if the object written is a plain <code>str</code>, <code>Exception</code>, or <code>JsException</code>, we'll pass it though to <code class="code">Element.write()</code> unchanged. This preserves some of the functionality around how PyScript currrently does error handling and presentation.</li>
        <li>Otherwise, we'll use a context manager to temporarily redirect <code>stdout</code> to a buffer, feed the object to <code class="code">rich.console.print()</code>, and capture that output in the buffer.</li>
        <li>When the context manager closes, it writes its contents to the appropriate element using the original <code class="code">Element.write()</code> functionality.</li>
    </ul>
</p>
<p class="post-p"> I've implemented a rudementary <a href="https://docs.python.org/3/glossary.html#term-file-object">File-like object</a> called <code class="code">output_buffer</code> that simply saves anything written to it as a concatenated string. If this isn't the first thing in the buffer, we insert a <code class="code">&lt;br&gt;</code> tag to make it start on a new line. This is admittedly a hack, but it largely gives the right appearance.</p>
<div class="mb-6 overflow-y-scroll h-76 lg:mx-4">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># PyScripts OutputCTXManager is used for stdout but does not implement</span>
<span style="color:#75715e"># full fill interface; this prevents a warning each time console tries</span>
<span style="color:#75715e"># to print</span>
stdout<span style="color:#f92672">.</span>flush <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span>: <span style="color:#66d9ef">None</span>

<span style="color:#75715e">##---- Redefine Pyscript.write()---</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">output_buffer</span>():
    <span style="color:#e6db74">&#34;&#34;&#34; A (inefficient) buffer to capture stdout to a string &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>_internal_buffer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">write</span>(self, value: any):
        <span style="color:#66d9ef">if</span> len(self<span style="color:#f92672">.</span>_internal_buffer):
            self<span style="color:#f92672">.</span>internal_buffer <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;&lt;br&gt;&#39;</span>
        self<span style="color:#f92672">.</span>_internal_buffer <span style="color:#f92672">+=</span> value

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_internal_buffer

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">flush</span>(self):
        <span style="color:#66d9ef">pass</span>

<span style="color:#a6e22e">@contextmanager</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stdout_to_buffer</span>(el:Element, append: bool) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
    <span style="color:#e6db74">&#34;&#34;&#34; A context manager to manage an output_buffer, writes to an Element on closure&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">global</span> stdout <span style="color:#75715e">#Usually Pyscript OutputCTXManager at this pont</span>
    _old_stdout <span style="color:#f92672">=</span> stdout
    stdout <span style="color:#f92672">=</span> output_buffer()
    <span style="color:#66d9ef">try</span>:
        <span style="color:#66d9ef">yield</span>
    <span style="color:#66d9ef">finally</span>:
        el<span style="color:#f92672">.</span>_write(stdout<span style="color:#f92672">.</span>read(), append)
        stdout <span style="color:#f92672">=</span> _old_stdout 

Element<span style="color:#f92672">.</span>_write <span style="color:#f92672">=</span> Element<span style="color:#f92672">.</span>write

<span style="color:#75715e">#Allow Element.write() to take an object from rich</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">newWrite</span>(self, value, append: bool <span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
    <span style="color:#e6db74">&#34;&#34;&#34; A Monkeypatched version of Pyscript&#39;s Element.write(), auto-transforming Rich objects and rendering standard objects. &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">if</span> isinstance(value, (str, <span style="color:#a6e22e">Exception</span>, JsException)):
        self<span style="color:#f92672">.</span>_write(value, append)
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">with</span> stdout_to_buffer(self, append):
            get_console()<span style="color:#f92672">.</span>print(value)

Element<span style="color:#f92672">.</span>write <span style="color:#f92672">=</span> newWrite</code></pre></td></tr></table>
</div>
</div>
</div>
<p class="post-img-caption">Scroll to see complete code</p>
<h2 class="post-h2">What About ...</h2>
<p class="post-p">Those who are familiar with the various ways Rich already provides to capture its own output, as well as exporting it as HTML, may have some reasonable questions here. It's surely possible I've missed something in Rich's expansive API, but I didn't find a solution that did everything I want without implementing my own context manager. That said, it does feel like there shuold be a simpler way...</p>
<ul class="post-ul">
    <li>I wanted to make the default console returned by <code class="code">get_console()</code> have the desired behavior, as well as any consoles the user created in the future. Hence the reason for overriding the _is_jupyter method instead of just making the default console <code class="code">force_jupyter=True</code></li>
    <li>Using <code class="code">Console.capture()</code> captures the entire contents of the console, from which it can be exported (or saved as a file) to HTML, but there isn't a direct way to save just the user-input-turned-into-HTML as far as I know.</li>
    <li>Because <a href="https://github.com/Textualize/rich/blob/8e2da1afab8743d8e3c55b8191492cc5f9905b7f/rich/jupyter.py#L84-L95">Rich's jupyter.display() method</a> tries specifically to write to an iPython display, I needed to override this method to render the objects to HTML and just write those to std.</li>
</ul>
<p class="post-p">With all these pieces put together, now most writes to stdout should be formatted using Rich's format rules.</p>
<h2 class="post-h2" id="live-updates">Live Updates</h2>
<p class="post-p">While there are lots of things that make running Python inside a browser window different from running in a terminal/desktop environment, one of the most striking is that we only have one event loop and we can't block it. Ever. Even a simple <code class="code">time.sleep(1)</code> irrevocably blocks the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop">JavaScript event loop</a>.</p>
<p class="post-p">This is where asyncio comes to the rescue. The Pyodide runtime has a custom event loop ("<a href="https://pyodide.org/en/stable/usage/api/python-api/webloop.html#module-pyodide.webloop">Webloop</a>") that hooks to the asyncio webloop, allowing nonblock asynchronous operations. For example, we can use <code class="code">asyncio.sleep()</code> instead of <code>time.sleep()</code>, <code class="code">asynccontextmanager</code>s instead of <code>context managers</code>, and so on.</p>
<p class="post-p">Hooking this deep into Rich's functionality requires some significant rewriting of the <a href="https://rich.readthedocs.io/en/stable/live.html">Live class</a>, as well as an additional helper class that constantly refreshes the live display by adding new callouts to the event loop every quarter second. The full results are below.</p>
<p class="post-p">If you want to use the Live update element in your PyScript page, you'll want to:
    <ul class="mb-6 post-ul">
        <li>Add the following code to a PyScript tag near the top of your page.</li>
        <li>Use the included <code>Live</code> class instead of importing from <code>Rich.live</code>. It has the same interface as Rich.live, though not all features are implemented yet.</li>
        <li>Avoid using any blocking io calls, instead substituting with their async versions. For an example of how to use the new Live class <a href="https://rich.readthedocs.io/en/stable/live.html">in the same way Rich does</a> (i.e. as a context manager), see the live examples on the <a href="../../project/richdemo">Rich Demo</a> page.</li>
    </ul>
</p>
<div>
    <p class="code-title">_livepatch.py</p>
    
    
    <div class="overflow-y-scroll h-52">
    
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">import</span> asyncio
<span style="color:#f92672">from</span> rich <span style="color:#f92672">import</span> get_console
<span style="color:#f92672">from</span> rich.console <span style="color:#f92672">import</span> Console, RenderableType, ConsoleRenderable
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Type, Optional, Callable, IO, List
<span style="color:#f92672">from</span> types <span style="color:#f92672">import</span> TracebackType
<span style="color:#f92672">from</span> rich.live_render <span style="color:#f92672">import</span> VerticalOverflowMethod

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PyscriptRefresher</span>():
    <span style="color:#66d9ef">def</span> __init__(
        self,
        renderable: RenderableType,
        element: <span style="color:#e6db74">&#39;Element&#39;</span>,
        live: <span style="color:#e6db74">&#39;Live&#39;</span>,
        refresh_per_second: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,
    ) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        self<span style="color:#f92672">.</span>_renderable <span style="color:#f92672">=</span> renderable
        self<span style="color:#f92672">.</span>live <span style="color:#f92672">=</span> live
        self<span style="color:#f92672">.</span>element <span style="color:#f92672">=</span> element
        self<span style="color:#f92672">.</span>refresh_per_second <span style="color:#f92672">=</span> refresh_per_second
        self<span style="color:#f92672">.</span>done <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
        self<span style="color:#f92672">.</span>_refresh_task <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>


    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_live</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;Starting update live function&#34;</span>)
        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
            console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;About to write </span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>_renderable<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
            self<span style="color:#f92672">.</span>element<span style="color:#f92672">.</span>write(self<span style="color:#f92672">.</span>_renderable)
            <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>refresh_per_second)


    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self) <span style="color:#f92672">-&gt;</span> bool:
        <span style="color:#e6db74">&#34;&#34;&#34;Starts the refresh coroutine if it is not already running
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        Returns:
</span><span style="color:#e6db74">            True if the coroutine was successfully created and started
</span><span style="color:#e6db74">            False if the coroutine was already running, or not successfully created
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_refresh_task <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
        loop <span style="color:#f92672">=</span> pyscript<span style="color:#f92672">.</span>loop
        console<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#34;About to start running refresh task&#34;</span>)
        self<span style="color:#f92672">.</span>_refresh_task <span style="color:#f92672">=</span> loop<span style="color:#f92672">.</span>create_task(self<span style="color:#f92672">.</span>update_live())
        <span style="color:#75715e">#loop.run_until_complete(self._refresh_task)</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stop</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        <span style="color:#e6db74">&#34;&#34;&#34;Stops the refresh coroutine if it is running&#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_refresh_task <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
            self<span style="color:#f92672">.</span>_refresh_task<span style="color:#f92672">.</span>cancel()
            self<span style="color:#f92672">.</span>_refresh_task <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Live</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;Renders an auto-updating live display of any given renderable.
</span><span style="color:#e6db74">    Mirrors the API of rich.live.LIVE
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Args:
</span><span style="color:#e6db74">        renderable (RenderableType, optional): The renderable to live display. Defaults to displaying nothing.
</span><span style="color:#e6db74">        console (Console, optional): Optional Console instance. Default will an internal Console instance writing to stdout. &gt;&gt;&gt; NOT IMPLEMENTED
</span><span style="color:#e6db74">        auto_refresh (bool, optional): Enable auto refresh. If disabled, you will need to call `refresh()` or `update()` with refresh flag. Defaults to True &gt;&gt;&gt; NOT IMPLEMENTED
</span><span style="color:#e6db74">        refresh_per_second (float, optional): Number of times per second to refresh the live display. Defaults to 4. &gt;&gt;&gt; NOT IMPLEMENTED
</span><span style="color:#e6db74">        transient (bool, optional): Clear the renderable on exit (has no effect when screen=True). Defaults to False. &gt;&gt;&gt; NOT IMPLEMENTED
</span><span style="color:#e6db74">        redirect_stdout (bool, optional): Enable redirection of stdout, so ``print`` may be used. Defaults to True. &gt;&gt;&gt; NOT IMPLEMENTED
</span><span style="color:#e6db74">        redirect_stderr (bool, optional): Enable redirection of stderr. Defaults to True. &gt;&gt;&gt; NOT IMPLEMENTED
</span><span style="color:#e6db74">        vertical_overflow (VerticalOverflowMethod, optional): How to handle renderable when it is too tall for the console. Defaults to &#34;ellipsis&#34;. &gt;&gt;&gt; NOT IMPLEMENTED
</span><span style="color:#e6db74">        get_renderable (Callable[[], RenderableType], optional): Optional callable to get renderable. Defaults to None. &gt;&gt;&gt; NOT IMPLEMENTED
</span><span style="color:#e6db74">        element_id (str): The id of a DOM element (often a div) that the live element will be written to
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        The screen parameters of rich.live.Live is not used
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> __init__(
        self,
        renderable: Optional[RenderableType] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
        element_id: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>,
        <span style="color:#f92672">*</span>,
        rich_console: Optional[Console] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
        <span style="color:#75715e">#screen: bool attribute not used</span>
        auto_refresh: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>,
        refresh_per_second: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,
        transient: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>,
        redirect_stdout: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>,
        redirect_stderr: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>,
        vertical_overflow: VerticalOverflowMethod <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ellipsis&#34;</span>,
        get_renderable: Optional[Callable[[], RenderableType]] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
        <span style="color:#f92672">**</span>kwargs
    ) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        <span style="color:#66d9ef">assert</span> refresh_per_second <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;refresh_per_second must be &gt; 0&#34;</span>
        self<span style="color:#f92672">.</span>_renderable <span style="color:#f92672">=</span> renderable
        self<span style="color:#f92672">.</span>console <span style="color:#f92672">=</span> rich_console <span style="color:#66d9ef">if</span> rich_console <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#66d9ef">else</span> get_console()
        <span style="color:#75715e">#self._screen = screen</span>
        self<span style="color:#f92672">.</span>_alt_screen <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>

        self<span style="color:#f92672">.</span>_redirect_stdout <span style="color:#f92672">=</span> redirect_stdout
        self<span style="color:#f92672">.</span>_redirect_stderr <span style="color:#f92672">=</span> redirect_stderr
        self<span style="color:#f92672">.</span>_restore_stdout: Optional[IO[str]] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
        self<span style="color:#f92672">.</span>_restore_stderr: Optional[IO[str]] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>

        <span style="color:#75715e">#self._lock = RLock()</span>
        self<span style="color:#f92672">.</span>auto_refresh <span style="color:#f92672">=</span> auto_refresh
        self<span style="color:#f92672">.</span>transient <span style="color:#f92672">=</span> transient

        self<span style="color:#f92672">.</span>vertical_overflow <span style="color:#f92672">=</span> vertical_overflow
        self<span style="color:#f92672">.</span>_get_renderable <span style="color:#f92672">=</span> get_renderable

        <span style="color:#66d9ef">assert</span> element_id <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>
        self<span style="color:#f92672">.</span>element <span style="color:#f92672">=</span> Element(element_id)

        self<span style="color:#f92672">.</span>refresh_per_second <span style="color:#f92672">=</span> refresh_per_second
        self<span style="color:#f92672">.</span>_refresh_thread <span style="color:#f92672">=</span> PyscriptRefresher(renderable <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_renderable, element <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>element, live<span style="color:#f92672">=</span>self, refresh_per_second <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>refresh_per_second)
        

    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_started</span>(self) <span style="color:#f92672">-&gt;</span> bool:
        <span style="color:#e6db74">&#34;&#34;&#34;Check if live display has been started.&#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_refresh_thread<span style="color:#f92672">.</span>_refresh_task <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_renderable</span>(self) <span style="color:#f92672">-&gt;</span> RenderableType:
        renderable <span style="color:#f92672">=</span> (
            self<span style="color:#f92672">.</span>_get_renderable()
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_get_renderable <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>
            <span style="color:#66d9ef">else</span> self<span style="color:#f92672">.</span>_renderable
        )
        <span style="color:#66d9ef">return</span> renderable <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start</span>(self, refresh: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        <span style="color:#e6db74">&#34;&#34;&#34;Start live rendering display.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        Args:
</span><span style="color:#e6db74">            refresh (bool, optional): Also refresh. Defaults to False.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        
        <span style="color:#66d9ef">if</span> refresh: self<span style="color:#f92672">.</span>element<span style="color:#f92672">.</span>write(self<span style="color:#f92672">.</span>_renderable)
        self<span style="color:#f92672">.</span>_refresh_thread<span style="color:#f92672">.</span>run()

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stop</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        <span style="color:#e6db74">&#34;&#34;&#34;Stop live rendering display.&#34;&#34;&#34;</span>
        self<span style="color:#f92672">.</span>_refresh_thread<span style="color:#f92672">.</span>stop()

    <span style="color:#66d9ef">def</span> __enter__(self) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Live&#39;</span>:
        self<span style="color:#f92672">.</span>start(refresh<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_renderable <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>)
        <span style="color:#66d9ef">return</span> self

    <span style="color:#66d9ef">def</span> __exit__(
        self,
        exc_type: Optional[Type[<span style="color:#a6e22e">BaseException</span>]],
        exc_val: Optional[<span style="color:#a6e22e">BaseException</span>],
        exc_tb: Optional[TracebackType],
    ) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        self<span style="color:#f92672">.</span>stop()

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">renderable</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_renderable

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(self, renderable: RenderableType, <span style="color:#f92672">*</span>, refresh: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        <span style="color:#e6db74">&#34;&#34;&#34;Update the renderable that is being displayed
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        Args:
</span><span style="color:#e6db74">            renderable (RenderableType): New renderable to use.
</span><span style="color:#e6db74">            refresh (bool, optional): Refresh the display. Defaults to False.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span> <span style="color:#75715e">#Not implemented</span>
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">refresh</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
        <span style="color:#e6db74">&#34;&#34;&#34;Update the display of the Live Render.&#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span> <span style="color:#75715e">#not implemented</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_renderables</span>(
        self, renderables: List[ConsoleRenderable]
    ) <span style="color:#f92672">-&gt;</span> List[ConsoleRenderable]:
        <span style="color:#66d9ef">pass</span> <span style="color:#75715e">#not implemented</span>
</code></pre></td></tr></table>
</div>
</div>
    
    </div>
    <p class="post-img-caption">Scroll to see complete code</p>
    
</div>
<py-script src="_livepatch.py"></py-script>
<h3 class="post-h3">Live Table Demo</h3>
<div class="flex flex-col space-x-2 xl:flex-row gap-y-2">
    <div class="w-full bg-gray-200 border-2 border-gray-400 xl:w-1/2 ">
        <py-script class="px-2" src="scripts/working/livetable.py"></py-script>
        <div id="live-table-output" class="h-56 overflow-y-auto"></div>
    </div>
    <div class="w-full xl:w-1/2"><div>
    <p class="code-title">livetable.py</p>
    
    
    <div class="overflow-y-scroll h-52">
    
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#f92672">import</span> asyncio
<span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> deque
<span style="color:#f92672">from</span> random <span style="color:#f92672">import</span> random, choice, randint
<span style="color:#f92672">from</span> rich.table <span style="color:#f92672">import</span> Table
<span style="color:#f92672">from</span> rich.emoji <span style="color:#f92672">import</span> Emoji
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
<span style="color:#f92672">from</span> faker <span style="color:#f92672">import</span> Faker
<span style="color:#75715e">#from livepatch import Live</span>

fake <span style="color:#f92672">=</span> Faker()

<span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">True</span>):
    table <span style="color:#f92672">=</span> Table(width <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>)
    table<span style="color:#f92672">.</span>add_column(<span style="color:#e6db74">&#34;Time&#34;</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
    table<span style="color:#f92672">.</span>add_column(<span style="color:#e6db74">&#34;Source&#34;</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>)
    table<span style="color:#f92672">.</span>add_column(<span style="color:#e6db74">&#34;Destination&#34;</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>)

    max_rows <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">10</span>)
    num_rows <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">while</span> num_rows <span style="color:#f92672">&lt;=</span> max_rows:
        <span style="color:#66d9ef">with</span> Live(table, <span style="color:#e6db74">&#34;live-table-output&#34;</span>):
            <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">.3</span> <span style="color:#f92672">+</span> random() <span style="color:#f92672">*</span> <span style="color:#ae81ff">.6</span>)
            num_rows <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

            time <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>now()<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%S.</span><span style="color:#e6db74">%f</span><span style="color:#e6db74">&#39;</span>)
            time <span style="color:#f92672">=</span> time[:min(len(time), <span style="color:#ae81ff">5</span>)]
            source, dest <span style="color:#f92672">=</span> fake<span style="color:#f92672">.</span>ipv4(), fake<span style="color:#f92672">.</span>ipv4()

            <span style="color:#75715e">#data added here is automatically visible in the Table</span>
            table<span style="color:#f92672">.</span>add_row(time, source, dest)         </code></pre></td></tr></table>
</div>
</div>
    
    </div>
    <p class="post-img-caption">Scroll to see complete code</p>
    
</div></div>
</div>
<h2 class="post-h2">What Works and What Doesn't</h2>
<p class="italic post-p">See the <a href="../../project/richdemo">demo page</a> for working examples.</p>
<p class="post-p">Out of the box, this allows for formatting of most static Rich objects: Text, Lists and Dicts, JSON objets, etc. The various formatting objects that rely on them - Panels, Columns, Layouts etc - also work.</p>
<p class="post-p">Some specific formatting tags are broken - though personally, I"m not too sad that <code>&lt;blink&gt;</code> doesn't work.</p>
<p class="post-p">Emoji are also (somewhat) broken, though that's mostly through me running out of time to look at their implementation in depth. A brief glance at the <a href="https://github.com/Textualize/rich/blob/master/rich/emoji.py">Emoji.py source</a> makes it look like perhaps what I'm doing for output is clobbering the unicode characters that should be output as Emoji? Or perhaps how they're being rendered - the TL;DR example at the top of the page shows (for me) a successful "hand-pointing-down" but a non-colored "play button".</p>
<hr class="my-6">    
<h2 class="post-h3">Things that Don't Work</h2>
<div class="flex flex-col space-y-6">
    <div class="flex flex-col space-x-2 xl:flex-row gap-y-2">
        <div class="w-full h-32 bg-red-100 border-2 border-gray-400 xl:w-1/2">
        <h3>Some Text Formatting Options</h3>
            <py-script class="px-2" src="scripts/not_working/richnonformatted.py"></py-script>
        </div>
        <div class="w-full xl:w-1/2"><div>
    <p class="code-title">richnonformatted.py</p>
    
    
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">print(<span style="color:#e6db74">&#34;[blink]Blinking Text[/blink]&#34;</span>)</code></pre></td></tr></table>
</div>
</div>
    
</div></div>
    </div>
    <div class="flex flex-col space-x-2 xl:flex-row gap-y-2">
        <div class="w-full h-32 bg-red-100 border-2 border-gray-400 xl:w-1/2">
        <h3>Emoji's (Ish)</h3>
            <py-script class="px-2" src="scripts/not_working/richemoji.py"></py-script>
        </div>
        <div class="w-full xl:w-1/2"><div>
    <p class="code-title">richemoji.py</p>
    
    
    <div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">print(<span style="color:#e6db74">&#34;:red_heart-emoji:&#34;</span>)
print(<span style="color:#e6db74">&#34;:red_heart-text:&#34;</span>)</code></pre></td></tr></table>
</div>
</div>
    
</div></div>
    </div>


<!-- <p class="line-through post-p">What breaks, however, is anything that uses threading under the hood to operate: live-updating displays, progress bars, that sort of thing. Since <a href="https://github.com/pyodide/pyodide/issues/237">threading isn't currently supported in Pyodide</a>, there's not much of a direct solution here, but some workarounds can be had by using <span class="italic">async-await</span> to concurrently update the state of these objects. Check out the <a href="#progress-bar">progress-bar demo</a> below for an example.</p>
<p class="px-2 mx-4 bg-gray-200 border-l-4 border-gray-800 post-p">Since writing the above, I've (almost) completed work on implementing a version of the <a href="https://rich.readthedocs.io/en/stable/live.html">Rich Live class</a> using pyodide's event loop and async/await instead of threads. That work is detailed in a separate post (coming soon), but there are some previews on twitter in the meantime: <a target="_blank" href="https://twitter.com/JeffersGlass/status/1559634350513299456?s=20&t=qHo-w2VcStd_-fWLtSdotQ">[1]</a> <a target="_blank" href="https://twitter.com/JeffersGlass/status/1559671709250342917?s=20&t=qHo-w2VcStd_-fWLtSdotQ">[2]</a> <a target="_blank" href="https://twitter.com/JeffersGlass/status/1559682257312423937?s=20&t=qHo-w2VcStd_-fWLtSdotQ">[3]</a>. I've left the examples below that using async/await directly as an example of what you might do if you want to manage updates more manually.</p> -->

<!-- <style>
    h3 {
        font-size: 1.5rem/* 24px */;
        line-height: 2rem/* 32px */;
        padding-bottom: 0.5rem;
        width: 100%;
        --tw-bg-opacity: 1;
        background-color: rgba(209, 213, 219, var(--tw-bg-opacity));
        padding-left: 0.25rem;
    }
</style>

<a id="patch"></a>
<h2 class="mb-6 post-h2" id="">The Code</h2>
<p class="post-p">Here's all of the code above compiled into a single .py file. To get Rich output on your own PyScript page, include the following code before any of your outputs, or as a separate file using <code class="code">src="..."</code>.</p>
<p class="post-p">Note that you'll need to have the Rich module in your environment - the easiest way to do this is using <code class="code">&lt;py-env&gt; - rich &lt;/py-env&gt;</code></p> -->

    
</div>
				</div>
				
				<hr/ >
<div class="p-2 mt-6 mb-2 overflow-y-auto border-8 border-gray-300 border-double rounded-lg">
  <p class="italic text-gray-700 hover:text-black hover:text-bold" id="show=hide-trigger"><span class="underline" id="show-hide-comments" >#Show/Add Comments</span> <svg id="arrow" width="16px" height="16px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="inline-block transition-transform duration-150"><path d="M5.56 14L5 13.587V2.393L5.54 2 11 7.627v.827L5.56 14z"/></svg></p>

  <div id="remarkbox-div" class="hidden">
      <noscript>
        <iframe id=remarkbox-iframe src="https://my.remarkbox.com/embed?nojs=true" style="height:600px;width:100%;border:none!important" tabindex=0></iframe>
      </noscript>
    </div>
    <script src="https://my.remarkbox.com/static/js/iframe-resizer/iframeResizer.min.js"></script>
    <script>
      var rb_owner_key = "bdeadbf5-222a-11ed-ac14-83aad5f5c937";
      var thread_uri = window.location.href;
      var thread_title = window.document.title;
      var thread_fragment = window.location.hash;
    
      
      var rb_src = "https://my.remarkbox.com/embed" + 
          "?rb_owner_key=" + rb_owner_key +
          "&thread_title=" + encodeURI(thread_title) +
          "&thread_uri=" + encodeURIComponent(thread_uri) + 
          thread_fragment;
    
      function create_remarkbox_iframe() {
        var ifrm = document.createElement("iframe");
        ifrm.setAttribute("id", "remarkbox-iframe");
        ifrm.setAttribute("scrolling", "no");
        ifrm.setAttribute("src", rb_src);
        ifrm.setAttribute("frameborder", "0");
        ifrm.setAttribute("tabindex", "0");
        ifrm.setAttribute("title", "Remarkbox");
        ifrm.style.width = "100%";
        document.getElementById("remarkbox-div").appendChild(ifrm);
      }
      create_remarkbox_iframe();
      iFrameResize(
        {
          checkOrigin: ["https://my.remarkbox.com"],
          inPageLinks: true,
          initCallback: function(e) {e.iFrameResizer.moveToAnchor(thread_fragment)}
        },
        document.getElementById("remarkbox-iframe")
      );
    </script>
    <style>
      .rotated {
        transform: rotate(90deg);
      };
    </style>
    <script>
      document.getElementById("show=hide-trigger").addEventListener("click", () => {

        comments = document.getElementById("remarkbox-div")
        if (comments.classList.contains('hidden')){
          comments.classList.remove('hidden');
          document.getElementById('remarkbox-iframe').focus()
          document.getElementById('show-hide-comments').innerText = "#Hide Comments"
          document.getElementById('arrow').style.transform = 'rotate(90deg)'
          
        }
        else {
          comments.classList.add('hidden');
          document.getElementById('show-hide-comments').innerText = "#Show/Add Comments"
          document.getElementById('arrow').style.transform = 'rotate(0deg)'
        }
      });
    </script>
</div>
			</article>
			<footer>
    <div class = "pt-4 pb-6 text-center text-gray-500" id="Footer">
        <p class="">All contents  Jeff Glass 2022. All rights reserved.</p>
        <p>See <a href="../../cloud-resume-challenge" class="underline">how this site was built</a>.</p>
    </div>
</footer>
		</div>
	</main>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/js/lightbox.min.js"></script>
	<script>
		lightbox.option({
			'fadeDuration': 200,
			'resizeDuration': 200
		})
	</script>
</body>
</html>
