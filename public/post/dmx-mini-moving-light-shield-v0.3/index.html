<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>DMX Mini Moving Light Shield V0.3</title>
	<meta name="description" content="Electronics, Making, Software Development, and Amateur Radio from a Midwest Nerd">
	
	
	
	
	<link rel ="stylesheet" type="text/css" href="../../css/style.css">
	
	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DMX Mini Moving Light Shield V0.3"/>
<meta name="twitter:description" content="As I hinted to in my original post about the Arduino Pro Mini DMX Shield, and then talked some about in my PCB Assembly Livestream, the latest version of my DMX shield is geared toward driving in miniature moving light."/>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/css/lightbox.min.css" />	
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />

	
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BZTF8S6M1E"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BZTF8S6M1E', { 'anonymize_ip': false });
}
</script>


	<link rel="icon" href="../../favicon.ico?v=2"> 
	
</head>
<body>
	
	<main>
		<header>

<div class="fixed z-20 flex flex-row items-end w-full p-2 bg-green-800 t-0">
    
    <div class="flex-none hidden lg:flex">
        <div class="flex-none px-2">
            <span class="px-4 text-3xl font-bold text-green-200 transition duration-500 transform hover:text-green-50">
                <a href='../../' class= "no-style-link">Jeff Glass</a>
            </span>
        </div>
        <div class="flex-none menu-item-green ">
            <a href="../../#Introduction" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Home
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../project" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Projects
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../post" class="z-30 clickable-link-box no-style-link"><span></span></a> Blog  
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../oneoff" class="z-30 clickable-link-box no-style-link"><span></span></a>
            One-Offs
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../resume" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Resume
        </div>
    </div>
    
    <div class="flex justify-start flex-1 w-auto lg:hidden align-left large-menu">
        <div class="flex-none menu-item-green mobile-menu-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </div>
        <div class="flex-none">
            <span class="px-4 text-3xl font-bold text-green-200 transition duration-500 transform hover:text-green-50">
                <a href='../../' class= "no-style-link">Jeff Glass</a>
            </span>
        </div>
    </div>
    
    
    <div class="hidden text-green-200 transition mobile-menu">
            <div class="w-auto m-auto"><a href="../../"         class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Home</a></div>
            <div class="w-auto m-auto"><a href="../../project"  class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Projects</a></div>
            <div class="w-auto m-auto"><a href="../../post"     class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Blog</a></div>
            <div class="w-auto m-auto"><a href="../../oneoff"   class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">One-Offs</a></div>
            <div class="w-auto m-auto"><a href="../../resume"   class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Resume</a></div>
    </div>
    
    <div class="justify-end flex-1 hidden w-auto h-auto align-top md:flex social-buttons">
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.youtube.com/channel/UCjgmTMVx2B5_DOB3bCZBq7A" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg class = "z-0" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M5 7H19C19.5523 7 20 7.44771 20 8V16C20 16.5523 19.5523 17 19 17H5C4.44772 17 4 16.5523 4 16V8C4 7.44772 4.44772 7 5 7ZM2 8C2 6.34315 3.34315 5 5 5H19C20.6569 5 22 6.34315 22 8V16C22 17.6569 20.6569 19 19 19H5C3.34315 19 2 17.6569 2 16V8ZM10 9L14 12L10 15V9Z" fill="currentColor"/>
            </svg>
        </div>
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.twitter.com/jeffersglass" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" class="ionicon" viewBox="0 0 512 512"><path d="M496 109.5a201.8 201.8 0 01-56.55 15.3 97.51 97.51 0 0043.33-53.6 197.74 197.74 0 01-62.56 23.5A99.14 99.14 0 00348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 002.54 22.1 280.7 280.7 0 01-203-101.3A95.69 95.69 0 0036 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0135.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 01-25.94 3.4 94.38 94.38 0 01-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0139.5 405.6a203 203 0 01-23.5-1.4A278.68 278.68 0 00166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 00496 109.5z" fill="currentColor"/></svg>
        </div>
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.linkedin.com/in/jeffrey-r-glass" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 512 512"><path d="M444.17,32H70.28C49.85,32,32,46.7,32,66.89V441.61C32,461.91,49.85,480,70.28,480H444.06C464.6,480,480,461.79,480,441.61V66.89C480.12,46.7,464.6,32,444.17,32ZM170.87,405.43H106.69V205.88h64.18ZM141,175.54h-.46c-20.54,0-33.84-15.29-33.84-34.43,0-19.49,13.65-34.42,34.65-34.42s33.85,14.82,34.31,34.42C175.65,160.25,162.35,175.54,141,175.54ZM405.43,405.43H341.25V296.32c0-26.14-9.34-44-32.56-44-17.74,0-28.24,12-32.91,23.69-1.75,4.2-2.22,9.92-2.22,15.76V405.43H209.38V205.88h64.18v27.77c9.34-13.3,23.93-32.44,57.88-32.44,42.13,0,74,27.77,74,87.64Z" fill="currentColor"/></svg>
        </div>
    </div>
</div>
</header>
<script>
    const btn = document.querySelector("div.mobile-menu-button")
    const mobileMenu = document.querySelector(".mobile-menu")
    const largeMenu = document.querySelector(".large-menu")
    const socialButtons = document.querySelector(".social-buttons")

    btn.addEventListener("click", () =>{
        openMenu();
    })

    function openMenu() {
        mobileMenu.classList.toggle("hidden");
        largeMenu.classList.toggle("hidden");
        socialButtons.classList.add("hidden");
    }

    
    const smSize = 640;
    const mdSize = 768;
    const largeSize = 1024;
    window.addEventListener('resize', function(event) {
        if (event.target.screen.width > smSize ){
            mobileMenu.classList.add("hidden");
            largeMenu.classList.remove("hidden");
        }
    }, true);
</script>

		<div class="w-full bg-green-800 bg-opacity-10">
			<div class="pt-16"></div>
			<article class="w-full px-16 pt-4 pb-4 m-auto lg:w-11/12 bg-gray-50">
				<h1 class="pb-2 text-4xl">DMX Mini Moving Light Shield V0.3</h1>
				
				<div>
					<span>Tags:</span>
					
					<a href="../../tags/arduino">arduino</a>
					
					<a href="../../tags/dmx">dmx</a>
					
					<a href="../../tags/jlcpcb">jlcpcb</a>
					
					<a href="../../tags/mini-mover-shield">mini-mover-shield</a>
					
				</div>
				
				<hr>
				<div>
					<p class="post-p">As I hinted to in my original post about the <a href="https://jeff.glass/2019/05/20/arduino-pro-mini-dmx-shield/">Arduino Pro Mini DMX Shield</a>, and then talked some about in my <a href="https://jeff.glass/2019/05/22/dmx-mini-mover-shield-pcb-assembly-stream/">PCB Assembly Livestream</a>, the latest version of my DMX shield is geared toward driving in miniature moving light. This means that, in addition to being able to receive DMX, the Arduino driving the device will need to be able to drive a couple of servos and dim a relatively high power LED. There are many way of skinning both of those cats, so let's look at the solutions that are present in V0.3 of the DMX shield.</p>
<p class="post-p"><div class="wp-block-image"><figure class="aligncenter is-resized"><img alt="" class="wp-image-397 post-img" height="310" src="IMG_7277-1024x768.jpg" width="413"/></figure></div></p>
<h4 class="post-h4">Servo Control
<p class="post-p">Of LED dimming and Servo control, the latter is the easier problem to solve. While there are <a href="https://www.digikey.com/products/en/integrated-circuits-ics/pmic-motor-drivers-controllers/744?k=&amp;pkeyword=&amp;sv=0&amp;pv1664=28&amp;pv1664=10&amp;pv1664=2&amp;sf=0&amp;FV=ffe002e8&amp;quantity=&amp;ColumnSort=0&amp;page=1&amp;stock=1&amp;pageSize=25">dedicated servo-driving IC's</a>, and <a href="https://www.digikey.com/products/en/motors-solenoids-driver-boards-modules/motor-driver-boards-modules/181?k=servo&amp;k=&amp;pkeyword=servo&amp;sv=0&amp;pv1987=9&amp;sf=0&amp;FV=ffe000b5&amp;quantity=&amp;ColumnSort=0&amp;page=1&amp;pageSize=25">modules</a>, almost any microcontroller, including the ATMEGA238/Arduino can control a hobby servo in a straightforward way using minimal additional hardware.</p>
<p class="post-p">A typical hobby servo needs only three wires running to it - +5 for power, Ground, and a control line. The control line carries the position data for the servo in the form of pulse width modulation. The servo expects to see a pulse every 20 milliseconds. A pulse of 1.5 ms corresponds to the center (90°) position of the servo. A 1 ms pulse rotates all the way in one direction (0°) and a 2 ms pulse rotates fully the other direction (180°). There is a standard<a href="https://www.arduino.cc/en/Reference/Servo"> Arduino Servo Library</a> that translates degrees inputted into the appropriate duration Servo pulses.</p>
<figure class="wp-block-image"><img alt="" class="wp-image-409 post-img" src="Sinais_controle_servomotor.jpg"/></figure><p class="post-img-caption">Image Credit: Wikimedia Member Hforesti, CC-SA-4.0</p>
<p class="post-p">The only additional hardware present on the V0.3 board for Servo control is, therefore, a bulkier <a href="https://www.digikey.com/product-detail/en/stmicroelectronics/L7805CV/497-1443-5-ND/585964">5V regulator</a>. The 5V regulator on an Arduino Pro Mini isn't particularly stout to begin with, and I've had issues on previous projects with "off brand" Pro Minis having even less 5V oomph than that. So there's a pair of DC input pads and a TO-220 packaged 7805 to provide a healthy amount of current for the servos.</p>
<h4 class="post-h4">LED Dimming
<p class="post-p">The LED dimming half of this project has a wider solution space than servo control. The typical solution is MOSFET dimming. A FET is switched on and off rapidly, with a variable duty cycle to control brightness. This is the solution that commercial <a href="https://www.amazon.com/Channel-Controller-Smoother-Indicator-Function/dp/B00Q1N1NVK/ref=sr_1_1_sspa?keywords=led+decoder&amp;qid=1558576077&amp;s=gateway&amp;sr=8-1-spons&amp;psc=1">DMX LED decoders</a> use, with a bank of 3A-5A fets, one per driven channel. It's simple and inexpensive.</p>
<figure class="wp-block-image"><img alt="" class="wp-image-410 post-img" src="dmxled.png"/></figure>
<p class="post-p">The problem is heat. MOSFETS with super-low on-DC resistances are expensive, and those with higher DC resistances create more heat. There's always a balance being struck between cost and current carrying capacity. Which is why most commercial DMX led dimmers sit in <a href="https://www.amazon.com/Channel-Controller-Smoother-Indicator-Function/dp/B01CCBG1SO/ref=sr_1_7?keywords=dmx+driver&amp;qid=1558576476&amp;s=gateway&amp;sr=8-7">a sweet spot between 3A and 5A</a>. And all of them come in metal cases, sometimes mounted to large heatsinks, to help with heat dissipation. Less than ideal for what is ultimately meant to be a 3D-printed moving light made of thermoplastic.</p>
<p class="post-p">The other problem is overcurrent regulation. For typical, inexpensive 3A per channel DMX LED driver, there's nothing to protect the FETs if you load up a channel with, say, 5A of load, there's nothing in the drivers to prevent the FETs heating up to their failure point. Or worse. See, for example, this example from a local theater:</p>
<div class="grid grid-cols-2">
<img alt="" class="w-auto wp-image-408 post-img" data-id="408" data-link="https://jeff.glass/?attachment_id=408#main" src="IMG_5124-1024x768.jpeg"/>
<img alt="" class="w-auto wp-image-407 post-img" data-id="407" data-link="https://jeff.glass/?attachment_id=407#main" src="IMG_7222-e1558576797290-1024x768.jpg"/>
</div>
<p class="post-p">After some investigation, it turned out that there was a wiring error causing a dead-short across one of the channels. Which subsequently burst into flames. No kidding. The Stage Manager reported seeing a cloud of smoke roll out of the vom, which it turned out was discharge from the fire extinguisher the crew was using. Yikes!</p>
<p class="post-p">With a controlled environment and a defined load, an overcurrent load is slightly less of a concern, but it seemed like there must be a more elegant solution to both the heat and overcurrent issues.</p>
<p class="post-p">The solution I'm currently trying is the the <a href="https://www.diodes.com/assets/Datasheets/AL8860.pdf">AL8860 Buck LED Driver</a>. It is essentially a DC-DC step-down converter which derives the average current through its load from a SET resistor between a couple of its pins. It has an input voltage from 4.5V to 40V, and in TSOT-25 form factor a maximum current of 1A. A TTL PWM signal applied to its CTRL pin brings the average current down from the maximum SET current to between 0 and 100% of maximum, depending on duty cycle.</p>
<figure class="wp-block-image"><img alt="" class="wp-image-411 post-img" src="AL8860_circuit.png"/></figure>
<p class="post-p">While the IC itself ultimately uses an NDMOS FET to do its switching with a relatively high on-state resistance (200 mOhm), its incorporation of current management and a step-down converter directly into the IC makes it an attractive option. And for the form factors I'm looking at, I'm not likely to be pushing more than 1A through an LED star anyway.</p>
<p class="post-p">The AL8860 requires a few external components as a buck converter would - an inductor and a schottky diode - as well as a bypass cap and the SET resistor(s). These altogether take up about as much PCB space as a decently sized FET switch would, let a long the voltage conversation IC's that would allow this to run on a variable voltage.</p>
<p class="post-p"><div class="wp-block-image"><figure class="aligncenter"><img alt="" class="wp-image-412 post-img" src="PCB-layout-focus-dimming.png"/></figure><p class="post-img-caption">The portion of the PCB directly responsibly for 1A LED dimming. Approximately 8mm x 8mm. The two large thru holes directly below this are points to solder leads from the LED star directly.</p></div></p>
<h4 class="post-h4">Testing</h4>
<p class="post-p">I made the bold choice of testing this IC and hardware on a livestream recently. But not before an unscucessful attempt test attempt.</p>
<p class="post-p">In an attempt to validate this IC idea before committing to it, I purchased a handful of AL8860s, schottky diodes, 0.1 Ohm resistors, and inductors, and tried to piece together this idea on a piece of copper-clad. That did not, in short, go well. Without proper pads, I couldn't get the IC to stay in place well enough to solder magnet-wire to it. Even after I super-glued it down, the heat from my soldering iron weakened the super glue and caused it to come unstuck. And release superglue fumes. Fun!</p>
<p class="post-p">So I pulled the trigger on ordering a batch of the V0.3 PCB's, this time from JLCPCB. But in my rush, I didn't run a final Design Rule Check, and the pads for my Pan and Tilt servos overlap. Ah well, this was mostly to validate the LED dimming circuit.</p>
<p class="post-p">And validate it did! Check out this gif from my testing session:</p>
<p class="post-p"><div class="wp-block-image"><figure class="aligncenter"><img alt="" class="wp-image-415 post-img" src="DimmingTestGif.gif"/></figure></div></p>
<p class="post-p">Now that's some light! The arduino was just running a simple ramp-up/ramp-down for validation.</p>
<p class="post-p">The LEDs are from LEDSupply, a vendor on the east coast that I haven't used before, but stumbled upon while looking for LED options. They happen to be having a closeout sale on some <a href="https://www.ledsupply.com/closeout/luxeon-r-triple-3-up-neutral-white-led-star">Luxeon R 3-LED stars</a>, which seemed like a good option for something I might smoke or blow up. The LEDs themselves are <a href="https://www.lumileds.com/uploads/355/DS101-pdf">Luxeon LXA7-PW40</a>s. And with the appropriate <a href="https://www.ledsupply.com/triple-carclo-led-optics">Carclo optic</a>, the beam width is fairly narrow. The heatsink is just something from the junk bin.</p>
<p class="post-p">At 1000mA forward current (which LEDSupply recommends as the maximum allowed current), they emit around 975 lumens total, around <a href="https://www.1000bulbs.com/search?breadcrumbs%5B0%5D=light-bulbs&amp;breadcrumbs%5B1%5D=halogen-light-bulbs&amp;breadcrumbs%5B2%5D=halogen-par-lamps&amp;facet.multiselect=true&amp;page=1&amp;q=%2A&amp;rows=15&amp;son=0&amp;sort=price+asc&amp;start=0&amp;filter=(category:%225659%22)&amp;filter=(a_bulb_shape_t_fq:%22PAR16%22)">what a 75W PAR16 lamp emits.</a> Even testing at 500mA as I was, it's a punchy little package!</p>
<h4 class="post-h4">Next Steps
<p class="post-p">There's some CAD time in my future. I'll need to whip up a case to hold the PCB and accommodate a pan servo. I think the arm and body components I will be able to mostly re-use from my previous design, possibly with a little extra room in the head for a proper heatsink.</p>
<p class="post-p"><div class="wp-block-image"><figure class="aligncenter is-resized"><img alt="" class="wp-image-418 post-img" height="376" src="MovingLightTinySnip.png" width="357"/></figure><p class="post-img-caption">The previous tiny moving-light design</p></div></p>
<p class="post-p">At some point, I'll have to re-order PCB's with the errors corrected, especially the overlapping servo-control pads. I may also want to rethink the mounting hole locations, and possibly bring the DC and DMX inputs out onto their own little tabs to solder connectors onto. But first, I think it will be satisfying to bring this version of the LED to life.</p>
</h4></h4></h4>
				</div>
				
			</article>
			<footer>
    <div class = "pt-4 pb-6 text-center text-gray-500" id="Footer">
        <p class="">All contents © Jeff Glass 2022. All rights reserved.</p>
        <p>See <a href="../../cloud-resume-challenge" class="underline">how this site was built</a>.</p>
    </div>
</footer>
		</div>
	</main>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/js/lightbox.min.js"></script>
	<script>
		lightbox.option({
			'fadeDuration': 200,
			'resizeDuration': 200
		})
	</script>
</body>
</html>
