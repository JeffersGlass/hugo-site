<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Page Bundles and Image Processing</title>
	<meta name="description" content="Electronics, Making, Software Development, and Amateur Radio from a Midwest Nerd">
	
	
	
	
	<link rel ="stylesheet" type="text/css" href="../../css/style.css">
	
	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Page Bundles and Image Processing"/>
<meta name="twitter:description" content="As I figure out my workflow for creating pages, especially the &#34;"/>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/css/lightbox.min.css" />	
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />

	
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BZTF8S6M1E"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BZTF8S6M1E', { 'anonymize_ip': false });
}
</script>


	<link rel="icon" href="../../favicon.ico?v=2"> 
	
</head>
<body>
	
	<main>
		<header>

<div class="fixed z-20 flex flex-row items-end w-full p-2 bg-green-800 t-0">
    
    <div class="flex-none hidden lg:flex">
        <div class="flex-none px-2">
            <span class="px-4 text-3xl font-bold text-green-200 transition duration-500 transform hover:text-green-50">
                <a href='../../' class= "no-style-link">Jeff Glass</a>
            </span>
        </div>
        <div class="flex-none menu-item-green ">
            <a href="../../#Introduction" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Home
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../project" class="z-30 clickable-link-box no-style-link"><span></span></a>
            Projects
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../post" class="z-30 clickable-link-box no-style-link"><span></span></a> Blog  
        </div>
        <div class="flex-none menu-item-green">
            <a href="../../oneoff" class="z-30 clickable-link-box no-style-link"><span></span></a>
            One-Offs
        </div>
    </div>
    
    <div class="flex justify-start flex-1 w-auto lg:hidden align-left large-menu">
        <div class="flex-none menu-item-green mobile-menu-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </div>
        <div class="flex-none">
            <span class="px-4 text-3xl font-bold text-green-200 transition duration-500 transform hover:text-green-50">
                <a href='../../' class= "no-style-link">Jeff Glass</a>
            </span>
        </div>
    </div>
    
    
    <div class="hidden text-green-200 transition mobile-menu">
            <div class="w-auto m-auto"><a href="../../"         class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Home</a></div>
            <div class="w-auto m-auto"><a href="../../project"  class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Projects</a></div>
            <div class="w-auto m-auto"><a href="../../post"     class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">Blog</a></div>
            <div class="w-auto m-auto"><a href="../../oneoff"   class="block w-auto px-2 py-2 m-auto text-2xl transition duration-300 no-style-link hover:bg-green-500">One-Offs</a></div>
    </div>
    
    <div class="justify-end flex-1 hidden w-auto h-auto align-top md:flex social-buttons">
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.youtube.com/channel/UCjgmTMVx2B5_DOB3bCZBq7A" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg class = "z-0" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M5 7H19C19.5523 7 20 7.44771 20 8V16C20 16.5523 19.5523 17 19 17H5C4.44772 17 4 16.5523 4 16V8C4 7.44772 4.44772 7 5 7ZM2 8C2 6.34315 3.34315 5 5 5H19C20.6569 5 22 6.34315 22 8V16C22 17.6569 20.6569 19 19 19H5C3.34315 19 2 17.6569 2 16V8ZM10 9L14 12L10 15V9Z" fill="currentColor"/>
            </svg>
        </div>
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.twitter.com/jeffersglass" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" class="ionicon" viewBox="0 0 512 512"><path d="M496 109.5a201.8 201.8 0 01-56.55 15.3 97.51 97.51 0 0043.33-53.6 197.74 197.74 0 01-62.56 23.5A99.14 99.14 0 00348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 002.54 22.1 280.7 280.7 0 01-203-101.3A95.69 95.69 0 0036 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0135.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 01-25.94 3.4 94.38 94.38 0 01-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0139.5 405.6a203 203 0 01-23.5-1.4A278.68 278.68 0 00166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 00496 109.5z" fill="currentColor"/></svg>
        </div>
        <div class="flex-none menu-item-green social-buttons">
            <a href="https://www.linkedin.com/in/jeffrey-r-glass" class="z-30 clickable-link-box no-style-link" target="_blank"><span></span></a>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 512 512"><path d="M444.17,32H70.28C49.85,32,32,46.7,32,66.89V441.61C32,461.91,49.85,480,70.28,480H444.06C464.6,480,480,461.79,480,441.61V66.89C480.12,46.7,464.6,32,444.17,32ZM170.87,405.43H106.69V205.88h64.18ZM141,175.54h-.46c-20.54,0-33.84-15.29-33.84-34.43,0-19.49,13.65-34.42,34.65-34.42s33.85,14.82,34.31,34.42C175.65,160.25,162.35,175.54,141,175.54ZM405.43,405.43H341.25V296.32c0-26.14-9.34-44-32.56-44-17.74,0-28.24,12-32.91,23.69-1.75,4.2-2.22,9.92-2.22,15.76V405.43H209.38V205.88h64.18v27.77c9.34-13.3,23.93-32.44,57.88-32.44,42.13,0,74,27.77,74,87.64Z" fill="currentColor"/></svg>
        </div>
    </div>
</div>
</header>
<script>
    const btn = document.querySelector("div.mobile-menu-button")
    const mobileMenu = document.querySelector(".mobile-menu")
    const largeMenu = document.querySelector(".large-menu")
    const socialButtons = document.querySelector(".social-buttons")

    btn.addEventListener("click", () =>{
        openMenu();
    })

    function openMenu() {
        mobileMenu.classList.toggle("hidden");
        largeMenu.classList.toggle("hidden");
        socialButtons.classList.add("hidden");
    }

    
    const smSize = 640;
    const mdSize = 768;
    const largeSize = 1024;
    window.addEventListener('resize', function(event) {
        if (event.target.screen.width > smSize ){
            mobileMenu.classList.add("hidden");
            largeMenu.classList.remove("hidden");
        }
    }, true);
</script>

		<div class="w-full bg-green-800 bg-opacity-10">
			<div class="pt-16"></div>
			<article class="w-full px-16 pt-4 pb-4 m-auto lg:w-11/12 bg-gray-50">
				<h1 class="pb-2 text-4xl">Page Bundles and Image Processing</h1>
				<p>Published November 5, 2021</p>
				
				<div>
					<span>Tags:</span>
					
					<a href="../../tags/cloud-resume">Cloud-Resume</a>
					
				</div>
				
				
				<hr>
				<div>
					<p class="post-p"></p>
<p class="post-p">As I figure out my workflow for creating pages, especially the "One Offs", I want to keep things as simple and straightforward as can be for adding new content. The intention of the One Offs is a place to memorialize small, interesting things - things that shouldn't disappear into twitter, but aren't a full project writeup. To that end, I'd like to have some standard formatting for all of their individual pages that makes it simple to add a new piece of content. So let's work on the /layouts/small/single.html layout.</p>
<p class="post-p">It turns out that there is no style being applied to external links currently, which is something I imagine I might want. So I'll add a css rule for &lt;a&gt; tags... and then add an ID to the label "Jeff Glass" in the header so it doesn't also get styled, and use a:not(#header-name) to prevent it from getting snagged by this new rule.</p>
<p class="post-p">To make things a little easier at this point, I'll add the postcss-nesting module following <a href="https://tailwindcss.com/docs/using-with-preprocessors">the steps in the Tailwind docs</a>. This did require refactoring my postcss.config.js file to use a list of require() statements instead of a map, as illustrated <a href="https://tailwindcss.com/docs/using-with-preprocessors">in the Tailwind Docs</a>:</p>
<p class="post-p"><div></div></p>
<p class="post-p"><div>/* Old version</div></p>
<p class="post-p"><div>module.exports = {</div></p>
<p class="post-p"><div>  plugins: {</div></p>
<p class="post-p"><div>    tailwindcss: {},</div></p>
<p class="post-p"><div>    autoprefixer: {},</div></p>
<p class="post-p"><div>  },</div></p>
<p class="post-p"><div>}*/</div></p>
<p class="post-p"></p>
<p class="post-p"><div> </div></p>
<p class="post-p"><div>//New, working version</div></p>
<p class="post-p"> </p>
<p class="post-p"><div>module.exports = {</div></p>
<p class="post-p"><div>  plugins: [</div></p>
<p class="post-p"><div>    require('tailwindcss/nesting'),</div></p>
<p class="post-p"><div>    require('tailwindcss'),</div></p>
<p class="post-p"><div>    require('autoprefixer'),</div></p>
<p class="post-p"><div>  ]</div></p>
<p class="post-p"><div>}</div></p>
<p class="post-p"></p>
<p class="post-p">I'm also borrowing <a href="https://davidwalsh.name/external-links-css">a bit of code from David Walsh</a> to automatically style external links with the "external link" symbol... well, I would have except it seems embedded html inside markdown files is a bit cumbersome in Hugo. It seems its markdown renderer, Goldmark, only allows directly adding HTML attributes to <em>header</em> tags via markdown. Thankfully, Ana Ulin came to the rescue with their <a href="https://anaulin.org/blog/hugo-raw-html-shortcode/">Raw HTML Shortcode</a>.... Or rather, that was the plan, but the ::after selector is fiddly in some way I can't understand yet. So for now I'm just a css class called "no-style-link" to exclude links I don't want to be formatted using the :not() operator. I'm moving on.</p>
<p class="post-p">(Some resources for when I come back to this: <a href="https://stackoverflow.com/questions/45691117/how-can-i-add-a-svg-as-content-on-before-pseudo-element-of-an-element">Stack Overflow</a>, <a href="https://www.geeksforgeeks.org/how-to-use-svg-with-before-or-after-pseudo-element/">Geeks for Geeks</a>, <a href="https://css-tricks.com/gotchas-on-getting-svg-into-production/">css-tricks</a>)</p>
<p class="post-p"><hr/></p>
<p class="post-p">It seems like the preferred way to keep image content near site content is through what Hugo calls <a href="https://gohugo.io/content-management/page-bundles/">Page Bundles</a>, where a page is represented by <a href="https://cloudcannon.com/community/learn/hugo-tutorial/page-bundles-and-shortcodes/#practical-work-creating-page-bundles-and-shortcodes">a folder containing the content</a> or <a href="https://www.hackification.io/software-development/hugo/page-bundles/the-basics/">a folder containing an _index.md file if the hierarchy is nested further</a>. It looks like, if I just move my current "small" projects markdown files (Parks.md, meterclock.md) into folders with the same name and rename the files to "index.md", all of the formatting and templating work I've done so far is preserved. Well that's good at least.</p>
<p class="post-p"><img alt="" class="aligncenter size-full wp-image-4018 post-img" height="440" src="page-bundles.png" width="518"/></p>
<p class="post-p">Now, I'll chose a small project to work on. How about the Votive Fence Hooks project? I'll just drop a couple of pictures from my phone into the weddinghooks folder. And by using the following range commands, I can get all the images to appear nicely formatted on the page (<a href="https://www.regisphilibert.com/blog/2018/01/hugo-page-resources-and-how-to-use-them/">this write-up was very helpful</a>):</p>
<p class="post-p"><div></div></p>
<p class="post-p"><div>            &lt;p&gt;{{ .Content }}&lt;/p&gt;</div></p>
<p class="post-p"><div>                {{ with .Page.Resources.ByType "image" }}</div></p>
<p class="post-p"><div>                &lt;div class="flex flex-wrap pt-4"&gt;</div></p>
<p class="post-p"><div>                    {{ range . }}</div></p>
<p class="post-p"><div>                        &lt;img src="{{ .RelPermalink }}" class="flex my-4 mr-8 max-h-60"&gt;</div></p>
<p class="post-p"><div>                    {{ end }}</div></p>
<p class="post-p"><div>                &lt;/div&gt;</div></p>
<p class="post-p"><div>                {{ end }}</div></p>
<p class="post-p"></p>
<p class="post-p"><div> </div></p>
<p class="post-p">I then rebuilt and pushed my site to Github and... something I've done has broken the formatting/sorting of the small cards on the frontpage, and the auto-generating of the tags. Basically all my work from the previous post. Which is frustrating, but my generation code is still there. So something I've done recently has broken that functionality. I wonder if it was moving the content into Page Bundles?</p>
<p class="post-p">Interestingly, the code still works when I serve locally with hugo... Oh, I must not have rebuilt with the -D flag on. That's better. Gotta remember that.</p>
<p class="post-p"><hr/></p>
<p class="post-p">So now onto image display. Currently, I'm loading the whole, large image to the end user, then using CSS to scale it down, when what I'd like to do is have the image be rescaled at build-time and served at that size. It seems that, once again, Hugo Pipes are the answer, but sadly, there doesn't seem to be a way to intregrate pipes functionality with page bundling. There's a <a href="https://hugo-mini-course.netlify.app/sections/optimizing/images/">Hugo Mini-Course on image processing</a> that seems the right track for that, but again, it specifies the images must be in the /assets folder.</p>
<p class="post-p">Instead, let's look at <a href="https://christianspecht.de/2020/08/10/creating-an-image-gallery-with-hugo-and-lightbox2/">Christian Sprecht's post on integrating Lightbox with Hugo</a>. And the lightbox documentation makes it seem like a simple-enough process. <del><em>I'll start by installing lightbox via npm using npm install lightbox2 --save-dev. Then I'll add the requisite references to the lightbox.css and lightbox.js files inside of my baseof.html template, so it's present on every page.</em></del></p>
<p class="post-p">In actuality, it turns out to be easier to reference this CSS and JS from CDN's. Then, in my /layouts/small/single.html template, I'll transform the range code to the following:</p>
<p class="post-p"><div></div></p>
<p class="post-p"><pre>{{ if gt (len (.Page.Resources.ByType "image")) 0 }}    <br/>    &lt;h2 class="pt-6 text-xl"&gt;Images&lt;/h2&gt;<br/>    {{ with .Page.Resources.ByType "image" }}<br/>    &lt;div class="flex flex-wrap pt-4"&gt;<br/>        {{ range . }}<br/>            &lt;a href="{{ .RelPermalink }}" data-lightbox="image-set"&gt;&lt;img src="{{ .RelPermalink }}" class="flex mb-4 mr-8 max-h-60"&gt;&lt;/a&gt;<br/>        {{ end }}<br/>    &lt;/div&gt;<br/>    {{ end }}<br/>{{ end}}</pre></p>
<p class="post-p"></p>
<p class="post-p">This ensures that the h2 "Images" header only appears if there are actually images to display, and turns all the loaded images into Lightbox links. The links all get their data-lightbox attribute set to the same thing (in this case "image-set", but it could be anything) so that the lightbox gallery that pops up is scrollable directly between pictures.</p>
<p class="post-p"><img alt="" class="aligncenter wp-image-4021 post-img" height="597" src="lightbox.gif" width="600"/></p>
<p class="post-p">Well that wasn't too hard! Now any images that live inside a small-project folder will be automatically added to a lightbox. Neato!</p>
<p class="post-p">During some cleanup, I encounted an odd issue with how the slug images were appearing/being found on the main page. This Stack Overflow post cleared up <a href="https://stackoverflow.com/questions/34247337/object-fit-not-affecting-images/34247563">some things about how object-cover works</a>, and I found some guidance on <a href="https://www.markusantonwolf.com/blog/guide-for-different-ways-to-access-your-image-resources/">how to reference images in the same folder as content</a>. During this modification, I accidently screwed up the default summary.html template (I editted it instead of the summary.html template for the 'small' taxonomy), but I found a <a href="https://stackoverflow.com/questions/338436/how-can-i-view-an-old-version-of-a-file-with-git">Stack Overflow post on using git to view past versions of files</a>, which helped me find the previous syntax and restore things. Since I figured the issue was in a single line, I didn't do anything fancy like a <a href="https://www.metaltoad.com/blog/beginners-guide-git-bisect-process-elimination">git bisect</a>, but that's a tool in the pocket for the future.</p>
<p class="post-p">aslkhad</p>

				</div>
				
				<hr/ >
<div class="p-2 mt-6 mb-2 overflow-y-auto border-8 border-gray-300 border-double rounded-lg">
  <p class="italic text-gray-700 hover:text-black hover:text-bold" id="show=hide-trigger"><span class="underline" id="show-hide-comments" >#Show/Add Comments</span> <svg id="arrow" width="16px" height="16px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="inline-block transition-transform duration-150"><path d="M5.56 14L5 13.587V2.393L5.54 2 11 7.627v.827L5.56 14z"/></svg></p>

  <div id="remarkbox-div" class="hidden">
      <noscript>
        <iframe id=remarkbox-iframe src="https://my.remarkbox.com/embed?nojs=true" style="height:600px;width:100%;border:none!important" tabindex=0></iframe>
      </noscript>
    </div>
    <script src="https://my.remarkbox.com/static/js/iframe-resizer/iframeResizer.min.js"></script>
    <script>
      var rb_owner_key = "bdeadbf5-222a-11ed-ac14-83aad5f5c937";
      var thread_uri = window.location.href;
      var thread_title = window.document.title;
      var thread_fragment = window.location.hash;
    
      
      var rb_src = "https://my.remarkbox.com/embed" + 
          "?rb_owner_key=" + rb_owner_key +
          "&thread_title=" + encodeURI(thread_title) +
          "&thread_uri=" + encodeURIComponent(thread_uri) + 
          thread_fragment;
    
      function create_remarkbox_iframe() {
        var ifrm = document.createElement("iframe");
        ifrm.setAttribute("id", "remarkbox-iframe");
        ifrm.setAttribute("scrolling", "no");
        ifrm.setAttribute("src", rb_src);
        ifrm.setAttribute("frameborder", "0");
        ifrm.setAttribute("tabindex", "0");
        ifrm.setAttribute("title", "Remarkbox");
        ifrm.style.width = "100%";
        document.getElementById("remarkbox-div").appendChild(ifrm);
      }
      create_remarkbox_iframe();
      iFrameResize(
        {
          checkOrigin: ["https://my.remarkbox.com"],
          inPageLinks: true,
          initCallback: function(e) {e.iFrameResizer.moveToAnchor(thread_fragment)}
        },
        document.getElementById("remarkbox-iframe")
      );
    </script>
    <style>
      .rotated {
        transform: rotate(90deg);
      };
    </style>
    <script>
      document.getElementById("show=hide-trigger").addEventListener("click", () => {

        comments = document.getElementById("remarkbox-div")
        if (comments.classList.contains('hidden')){
          comments.classList.remove('hidden');
          document.getElementById('remarkbox-iframe').focus()
          document.getElementById('show-hide-comments').innerText = "#Hide Comments"
          document.getElementById('arrow').style.transform = 'rotate(90deg)'
          
        }
        else {
          comments.classList.add('hidden');
          document.getElementById('show-hide-comments').innerText = "#Show/Add Comments"
          document.getElementById('arrow').style.transform = 'rotate(0deg)'
        }
      });
    </script>
</div>
			</article>
			<footer>
    <div class = "pt-4 pb-6 text-center text-gray-500" id="Footer">
        <p class="">All contents © Jeff Glass 2022. All rights reserved.</p>
        <p>See <a href="../../cloud-resume-challenge" class="underline">how this site was built</a>.</p>
    </div>
</footer>
		</div>
	</main>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/js/lightbox.min.js"></script>
	<script>
		lightbox.option({
			'fadeDuration': 200,
			'resizeDuration': 200
		})
	</script>
</body>
</html>
